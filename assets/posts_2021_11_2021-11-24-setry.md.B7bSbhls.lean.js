import{_ as s,a as e,af as i,o as t}from"./chunks/framework.C87LdZyP.js";const r="/assets/sentry-architecture.CGZ5NcGo.png",l="/assets/sentry-event-pipline.DTWfGhc9.png",n="/assets/sentry-project.BnDPSQLH.png",h="/assets/sentry-issue.YQbwM5bI.png",y=JSON.parse('{"title":"错误监控平台：Sentry","description":"","frontmatter":{"title":"错误监控平台：Sentry","date":"2021-11-24T00:00:00.000Z","tags":[],"category":["架构"]},"headers":[],"relativePath":"posts/2021/11/2021-11-24-setry.md","filePath":"posts/2021/11/2021-11-24-setry.md","lastUpdated":1718173059000}'),p={name:"posts/2021/11/2021-11-24-setry.md"};function o(k,a,d,c,u,g){return t(),e("div",null,a[0]||(a[0]=[i('<h2 id="错误监控平台概览" tabindex="-1">错误监控平台概览 <a class="header-anchor" href="#错误监控平台概览" aria-label="Permalink to &quot;错误监控平台概览&quot;">​</a></h2><h3 id="错误监控平台" tabindex="-1">错误监控平台 <a class="header-anchor" href="#错误监控平台" aria-label="Permalink to &quot;错误监控平台&quot;">​</a></h3><ul><li><a href="https://airbrake.io/" target="_blank" rel="noreferrer">AirBrake</a></li><li><a href="https://www.bugsnag.com/" target="_blank" rel="noreferrer">Bugsnag</a></li><li><a href="https://www.fundebug.com/" target="_blank" rel="noreferrer">Fundebug</a></li><li><a href="https://www.honeybadger.io/" target="_blank" rel="noreferrer">HoneyBadger</a></li><li><a href="https://www.overops.com/" target="_blank" rel="noreferrer">OverOps</a></li><li><a href="https://raygun.com/" target="_blank" rel="noreferrer">Raygun</a></li><li><a href="https://rollbar.com/" target="_blank" rel="noreferrer">Rollbar</a></li><li><a href="https://sentry.io/" target="_blank" rel="noreferrer">Sentry</a></li></ul><h3 id="sentry-优点" tabindex="-1">Sentry 优点 <a class="header-anchor" href="#sentry-优点" aria-label="Permalink to &quot;Sentry 优点&quot;">​</a></h3><ul><li>应用较广</li><li>有开源版本，可独立部署（虽然安装复杂，背后有32个组件）</li><li>错误消息内容完善</li><li>告警机制完善</li><li>上手容易</li><li>SDK丰富（支持上百种语言和框架）</li><li>错误追踪、环境管理等功能完善</li><li>插件丰富可以和Gitlab集成管理 Issue</li></ul><p>Sentry 可以及时的抓取生产、测试等环境的错误并进行语境，可以处理错误在暴露在终端用户之前。 详细的错误信息可以帮助开发人员很好的定位错误，</p><h3 id="sentry-缺点" tabindex="-1">Sentry 缺点 <a class="header-anchor" href="#sentry-缺点" aria-label="Permalink to &quot;Sentry 缺点&quot;">​</a></h3><ul><li>SSO支持SAML不支持OAuth2.0</li></ul><h2 id="概念" tabindex="-1">概念 <a class="header-anchor" href="#概念" aria-label="Permalink to &quot;概念&quot;">​</a></h2><h3 id="sentry-架构" tabindex="-1">Sentry 架构 <a class="header-anchor" href="#sentry-架构" aria-label="Permalink to &quot;Sentry 架构&quot;">​</a></h3><p><img src="'+r+'" alt=""></p><p>Sentry 用到了很多组件，主要是：</p><ul><li>网关做流量转发，分别到 用户Web 和客户端的Relay</li><li>Kafka、Redis、Postgres、RabbitMQ 做存储和消息分发</li></ul><p>Event 的处理流程如下：</p><p><img src="'+l+`" alt=""></p><h3 id="event" tabindex="-1">Event <a class="header-anchor" href="#event" aria-label="Permalink to &quot;Event&quot;">​</a></h3><p>每次产生的日志记录。包含：</p><ul><li>时间</li><li>时间级别</li><li>项目信息</li><li>环境信息</li><li>等</li></ul><h3 id="issue" tabindex="-1">Issue <a class="header-anchor" href="#issue" aria-label="Permalink to &quot;Issue&quot;">​</a></h3><p>相同地方产生的一个异常叫做一个Issue。</p><p>也就是 Sentry 通过它的算法对 Event 的一个聚合。</p><h3 id="dsn" tabindex="-1">DSN <a class="header-anchor" href="#dsn" aria-label="Permalink to &quot;DSN&quot;">​</a></h3><p>包含密钥的URL。相当数据库的链接URL。</p><h3 id="auth-token" tabindex="-1">Auth Token <a class="header-anchor" href="#auth-token" aria-label="Permalink to &quot;Auth Token&quot;">​</a></h3><p>账户创建的 令牌，可以授权访问 API。</p><h3 id="org" tabindex="-1">Org <a class="header-anchor" href="#org" aria-label="Permalink to &quot;Org&quot;">​</a></h3><h3 id="project" tabindex="-1">Project <a class="header-anchor" href="#project" aria-label="Permalink to &quot;Project&quot;">​</a></h3><h3 id="team" tabindex="-1">Team <a class="header-anchor" href="#team" aria-label="Permalink to &quot;Team&quot;">​</a></h3><h3 id="member" tabindex="-1">Member <a class="header-anchor" href="#member" aria-label="Permalink to &quot;Member&quot;">​</a></h3><h3 id="release" tabindex="-1">Release <a class="header-anchor" href="#release" aria-label="Permalink to &quot;Release&quot;">​</a></h3><h3 id="tag" tabindex="-1">Tag <a class="header-anchor" href="#tag" aria-label="Permalink to &quot;Tag&quot;">​</a></h3><h2 id="使用" tabindex="-1">使用 <a class="header-anchor" href="#使用" aria-label="Permalink to &quot;使用&quot;">​</a></h2><h3 id="javascript" tabindex="-1">JavaScript <a class="header-anchor" href="#javascript" aria-label="Permalink to &quot;JavaScript&quot;">​</a></h3><p>根据官方的示例，使用 CDN 来测试。</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">script</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">    src</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;https://browser.sentry-cdn.com/6.15.0/bundle.tracing.min.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">    integrity</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;sha384-1k7XKRQgqjUbNyG2sI+qsY8HTHMOeLdycMx6hoGuNSANZ3WrMa3LXkr+M4t+SIpF&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;">    crossorigin</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;localhost&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">Sentry.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">init</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  // dsn: &quot;http://11d45e411bbd41fbb24491772f701923@your.site.com/1&quot;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  release: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;my-project-name@1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  environment: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;staging&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  integrations: [</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Sentry.Integrations.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">BrowserTracing</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  tracesSampleRate: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">});</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">someUndefinedFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span></code></pre></div><p>本地启动一个服务器测试打开该网页，即可向 Sentry 上报一个错误。</p><h3 id="sourcemap" tabindex="-1">SourceMap <a class="header-anchor" href="#sourcemap" aria-label="Permalink to &quot;SourceMap&quot;">​</a></h3><p>线上环境的 JS 代码都是经过压缩的，我们可以通过上传 SourceMap 文件来解决这个问题。</p><p>可以通过 sentry-cli 或者 webpack plugin 来上传，具体可以参考官网。</p><h3 id="project-页面" tabindex="-1">Project 页面 <a class="header-anchor" href="#project-页面" aria-label="Permalink to &quot;Project 页面&quot;">​</a></h3><p><img src="`+n+'" alt=""></p><h3 id="issue-页面" tabindex="-1">Issue 页面 <a class="header-anchor" href="#issue-页面" aria-label="Permalink to &quot;Issue 页面&quot;">​</a></h3><p><img src="'+h+'" alt=""></p><h2 id="扩展" tabindex="-1">扩展 <a class="header-anchor" href="#扩展" aria-label="Permalink to &quot;扩展&quot;">​</a></h2><h3 id="通知" tabindex="-1">通知 <a class="header-anchor" href="#通知" aria-label="Permalink to &quot;通知&quot;">​</a></h3><p>除了常规的 Email 通知，我们还可以使用设置里的扩展 Webhook 来实现 钉钉、飞书等通知。</p><h3 id="gitlab-仓库" tabindex="-1">Gitlab 仓库 <a class="header-anchor" href="#gitlab-仓库" aria-label="Permalink to &quot;Gitlab 仓库&quot;">​</a></h3><p>集成 Gitlab 仓库后可以进行 Issue 关联。</p><h3 id="告警" tabindex="-1">告警 <a class="header-anchor" href="#告警" aria-label="Permalink to &quot;告警&quot;">​</a></h3><p>Sentry 的告警功能很完善，按照 UI 操作即可。</p><h3 id="入站过滤" tabindex="-1">入站过滤 <a class="header-anchor" href="#入站过滤" aria-label="Permalink to &quot;入站过滤&quot;">​</a></h3><p>项目设置里面我们可以设置过滤来过滤掉一些我们已经明确不需要处理的一些任务。</p><p>过滤条件有 IP、版本、错误等。</p><h3 id="issue-处理流程" tabindex="-1">Issue 处理流程 <a class="header-anchor" href="#issue-处理流程" aria-label="Permalink to &quot;Issue 处理流程&quot;">​</a></h3><p>Issue 一般要关联的责任人，Sentry 提供了一个简单的处理流程，以及自动处理的选项。</p>',55)]))}const m=s(p,[["render",o]]);export{y as __pageData,m as default};
