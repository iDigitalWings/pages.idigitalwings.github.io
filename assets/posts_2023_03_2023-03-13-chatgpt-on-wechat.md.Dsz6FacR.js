import{_ as a,a as t,af as l,o as e}from"./chunks/framework.C87LdZyP.js";const s="/assets/648071871201500.Cz6-SCcg.png",n="/assets/648474943049250.CkBSwxYE.png",h="/assets/651334055835375.BRWXbcAB.png",p="/assets/651408744659166.Bh2n3iZ1.png",k="/assets/651437612664083.DBsO528s.png",o="/assets/652015339320208.Bfww2cPw.png",r="/assets/651941569707291.CvoHM7LI.png",b=JSON.parse('{"title":"chatgpt-on-wechat: 使用ChatGPT搭建微信聊天机器人","description":"","frontmatter":{"title":"chatgpt-on-wechat: 使用ChatGPT搭建微信聊天机器人","date":"2023-03-13T00:00:00.000Z","tags":["ai","ml"],"category":["AI"]},"headers":[],"relativePath":"posts/2023/03/2023-03-13-chatgpt-on-wechat.md","filePath":"posts/2023/03/2023-03-13-chatgpt-on-wechat.md","lastUpdated":1718173059000}'),d={name:"posts/2023/03/2023-03-13-chatgpt-on-wechat.md"};function c(g,i,F,y,u,D){return e(),t("div",null,i[0]||(i[0]=[l('<blockquote><p>使用 ChatGPT 搭建微信聊天机器人，基于GPT 3.5/4.0 API实现， 支持个人微信、公众号、企业微信部署，能处理文本、语音和图片，访问操作系统和互联网。</p></blockquote><h2 id="预览" tabindex="-1">预览 <a class="header-anchor" href="#预览" aria-label="Permalink to &quot;预览&quot;">​</a></h2><p>部署后别人就可以和你的微信机器人聊天了，微信机器人后台会调用 ChatGPT 的接口进行对话：</p><p><img src="'+s+'" alt=""></p><p>当然也支持语言，还支持画图指令，虽然画的不咋地：</p><p><img src="'+n+`" alt=""></p><p>不过语音的话，他会在发送一个 MP3 文件，默认用的是谷歌的文字朗读生成语音的音频，点击文件就会自动播放。</p><h2 id="原理" tabindex="-1">原理 <a class="header-anchor" href="#原理" aria-label="Permalink to &quot;原理&quot;">​</a></h2><p>顺便提一句，微信机器人其实就相当于在后台启动一个电脑微信，然后用程序帮你收发消息。</p><p>收到消息的时候，程序进行判断要不要回复以及如何回复。</p><h2 id="功能" tabindex="-1">功能 <a class="header-anchor" href="#功能" aria-label="Permalink to &quot;功能&quot;">​</a></h2><ul><li><strong>多端部署</strong>： 有多种部署方式可选择且功能完备，目前已支持<strong>个人微信</strong>，<strong>微信公众号</strong>和<strong>企业微信应用</strong>等部署方式</li><li><strong>基础对话</strong>： <strong>私聊</strong>及<strong>群聊</strong>的消息智能回复，支持<strong>多轮会话</strong>上下文记忆，支持 <strong>GPT-3</strong>，<strong>GPT-3.5</strong>，<strong>GPT-4</strong> 模型</li><li><strong>语音识别</strong>： 可识别语音消息，通过文字或语音回复，支持 <strong>azure</strong>, <strong>baidu</strong>, <strong>google</strong>, <strong>openai</strong> 等多种语音模型</li><li><strong>图片生成</strong>： 支持<strong>图片生成</strong> 和 <strong>图生图</strong>（如照片修复），可选择 <code>Dell-E</code>, <code>stable diffusion</code>, <code>replicate</code> 模型</li><li><strong>丰富插件</strong>： 支持个性化<strong>插件扩展</strong>，已实现多角色切换、文字冒险、敏感词过滤、聊天记录总结等插件</li><li><strong>Tool工具</strong>： 与操作系统和<strong>互联网交互</strong>，支持最新信息搜索、数学计算、天气和资讯查询、网页总结，基于 <strong>chatgpt-tool-hub</strong> 实现</li></ul><h2 id="如何使用" tabindex="-1">如何使用 <a class="header-anchor" href="#如何使用" aria-label="Permalink to &quot;如何使用&quot;">​</a></h2><h3 id="openai-账号" tabindex="-1">OpenAI 账号 <a class="header-anchor" href="#openai-账号" aria-label="Permalink to &quot;OpenAI 账号&quot;">​</a></h3><p>使用 ChatGPT 实现就是注册 OpenAI 的账号，然后前往 <strong>API管理页面</strong> 创建一个 API Key，保存 API Key， 后面运行项目的时候需要使用这个 Key。</p><p>Key 的格式是：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sk-f6h9AGbtocxTocI7T3BlbkFJl6E0zeX7eFy0EcEEEdddKGeg</span></span></code></pre></div><blockquote><p>项目中默认使用的对话模型是 gpt3.5 turbo，计费方式是约每 500 汉字 (包含请求和回复) 消耗 $0.002，图片生成是每张消耗 $0.016。</p></blockquote><h3 id="开发环境" tabindex="-1">开发环境 <a class="header-anchor" href="#开发环境" aria-label="Permalink to &quot;开发环境&quot;">​</a></h3><p>支持 Linux、MacOS、Windows 系统开发运行，也可以部署在 Linux 作为服务运行。</p><p>克隆代码：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://github.com/zhayujie/chatgpt-on-wechat</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> chatgpt-on-wechat/</span></span></code></pre></div><p>安装核心依赖 (必选)：</p><p>能够创建机器人，并具有文字交流功能所需的最小依赖集合。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 可以文字聊天，但是不支持语音和画图</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> requirements.txt</span></span></code></pre></div><p>拓展依赖 (可选)，安装时间比较长，装好之后可以进行语音解析，发送语音，图片生成等任务：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -r</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> requirements-optional.txt</span></span></code></pre></div><ul><li>其中 <code>tiktoken</code> 要求 python 版本在3.8以上，它用于精确计算会话使用的tokens数量，强烈建议安装。</li><li>使用google或baidu语音识别需安装ffmpeg，</li><li>默认的openai语音识别不需要安装ffmpeg。</li><li>使用azure语音功能需安装依赖，并参考文档的环境要求。</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> azure-cognitiveservices-speech</span></span></code></pre></div><h3 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-label="Permalink to &quot;配置&quot;">​</a></h3><p>配置文件的模板在根目录的<code>config-template.json</code>中， 需复制该模板创建最终生效的 <code>config.json</code> 文件：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 如果没有 config.json , 会使用 config-template.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> config-template.json</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> config.json</span></span></code></pre></div><p>然后在 <code>config.json</code> 中填入配置，以下是对默认配置的说明，可根据需要进行自定义修改（请去掉注释）：</p><div class="language-json5 vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json5</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;open_ai_api_key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;YOUR API KEY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                          </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 填入上面创建的</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> API</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> KEY</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;model&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;gpt-3.5-turbo&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                                   </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 模型名称。当</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">use_azure_chatgpt</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">为</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">true</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">时，其名称为</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Azure</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">上</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">model</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> deployment</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">名称</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;proxy&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;127.0.0.1:7890&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                                  </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 代理客户端的</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ip</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">和端口</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;single_chat_prefix&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;bot&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;@bot&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">],                      </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 私聊时文本需要包含该前缀才能触发机器人回复</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;single_chat_reply_prefix&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;[bot] &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                       </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 私聊时自动回复的前缀，用于区分真人</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;group_chat_prefix&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;@bot&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">],                              </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 群聊时包含该前缀则会触发机器人回复</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;group_name_white_list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;ChatGPT测试群&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;ChatGPT测试群2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">], </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 开启自动回复的群名称列表</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;group_chat_in_one_session&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;ChatGPT测试群&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">],              </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 支持会话上下文共享的群名称</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;image_create_prefix&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;画&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;看&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;找&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">],                   </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 开启图片回复的前缀</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;conversation_max_tokens&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                            </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 支持上下文记忆的最多字符数</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;speech_recognition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                                </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 是否开启语音识别</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;group_speech_recognition&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                          </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 是否开启群组语音识别</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;use_azure_chatgpt&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,                                 </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 是否使用</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">Azure</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatGPT</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> service</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">代替</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">openai</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatGPT</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> service</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">.</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 当设置为</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">true</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">时需要设置</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> open_ai_api_base</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">，如</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//xxx.openai.azure.com/</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;character_desc&quot;</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;你是ChatGPT, 一个由OpenAI训练的大型语言模型, 你旨在回答并解决人们的任何问题，并且可以使用多种语言与人交流。&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,  </span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">#</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 人格描述</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  #</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> 订阅消息，公众号和企业微信</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">channel</span><span style="--shiki-light:#B31D28;--shiki-dark:#FF938A;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">中请填写，当被订阅时会自动回复，可使用特殊占位符。目前支持的占位符有{</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">trigger_prefix</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}，在程序中它会自动替换成bot的触发词。</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  &quot;subscribe_msg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;感谢您的关注！</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">这里是ChatGPT，可以自由对话。</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">支持语音对话。</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">支持图片输出，画字开头的消息将按要求创作图片。</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">支持角色扮演和文字冒险等丰富插件。</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">输入{trigger_prefix}#help 查看详细指令。&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>配置说明：</p><h4 id="个人聊天" tabindex="-1">个人聊天 <a class="header-anchor" href="#个人聊天" aria-label="Permalink to &quot;个人聊天&quot;">​</a></h4><p>个人聊天时，默认需要以 <code>&quot;bot&quot;</code> 或 <code>&quot;@bot&quot;</code> 为开头的内容才能触发机器人， 对应配置项 <code>single_chat_prefix</code>，如果不需要以前缀触发可以填写：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;single_chat_prefix&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span></code></pre></div><p>机器人回复的内容会以 <code>&quot;[bot] &quot;</code> 作为前缀， 以区分真人的回复， 对应的配置项为 <code>single_chat_reply_prefix</code>，如果不需要前缀可以填写：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;single_chat_reply_prefix&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;&quot;</span></span></code></pre></div><h4 id="群聊天" tabindex="-1">群聊天 <a class="header-anchor" href="#群聊天" aria-label="Permalink to &quot;群聊天&quot;">​</a></h4><p>群聊天中，群名称需配置在 <code>group_name_white_list</code> 中才能开启群聊自动回复。</p><p>如果想对<strong>所有群聊</strong>生效，可以直接填写：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;group_name_white_list&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;ALL_GROUP&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span></code></pre></div><ul><li>默认只要被人 <strong>@</strong> 就会触发机器人自动回复；</li><li>另外群聊天中只要检测到以 <code>&quot;@bot&quot;</code> 开头的内容，同样会自动回复（方便自己触发），这对应配置项 <code>group_chat_prefix</code>。</li></ul><p>可选配置:</p><ul><li><code>group_name_keyword_white_list</code>： 配置项支持模糊匹配群名称，</li><li><code>group_chat_keyword</code>： 配置项则支持模糊匹配群消息内容，用法与上述两个配置项相同。</li><li><code>group_chat_in_one_session</code>： 使群聊共享一个会话上下文，配置 <code>[&quot;ALL_GROUP&quot;]</code> 则作用于所有群聊</li></ul><h4 id="语音识别" tabindex="-1">语音识别 <a class="header-anchor" href="#语音识别" aria-label="Permalink to &quot;语音识别&quot;">​</a></h4><p>添加 <code>&quot;speech_recognition&quot;: true</code> 将开启语音识别，默认使用 openai 的 whisper 模型识别为文字， 同时以文字回复，该参数仅支持私聊 (注意由于语音消息无法匹配前缀，一旦开启将对所有语音自动回复，支持语音触发画图)；</p><p>添加 <code>&quot;group_speech_recognition&quot;: true</code> 将开启群组语音识别， 默认使用 openai 的 whisper 模型识别为文字，同时以文字回复， 参数仅支持群聊 (会匹配 <code>group_chat_prefix</code> 和 <code>group_chat_keyword</code>, 支持语音触发画图)；</p><p>添加 <code>&quot;voice_reply_voice&quot;: true</code> 将开启语音回复语音（同时作用于私聊和群聊） ， 但是需要配置对应语音合成平台的 key，由于<strong>itchat</strong>协议的限制，只能发送语音mp3文件， 若使用wechaty则回复的是微信语音。</p><h4 id="其他配置" tabindex="-1">其他配置 <a class="header-anchor" href="#其他配置" aria-label="Permalink to &quot;其他配置&quot;">​</a></h4><ul><li><code>model</code>: 模型名称，目前支持 <code>gpt-3.5-turbo</code>, <code>text-davinci-003</code>, <code>gpt-4</code>, <code>gpt-4-32k</code> (其中gpt-4 api暂未开放)</li><li><code>temperature</code>,<code>frequency_penalty</code>,<code>presence_penalty</code>: Chat API接口参数，详情参考<a href="https://platform.openai.com/docs/api-reference/chat" target="_blank" rel="noreferrer">OpenAI官方文档。</a></li><li><code>proxy</code>：由于目前 <code>openai</code> 接口国内无法访问，需配置代理客户端的地址，详情参考 <a href="https://github.com/zhayujie/chatgpt-on-wechat/issues/351" target="_blank" rel="noreferrer">#351</a></li><li>对于图像生成，在满足个人或群组触发条件外，还需要额外的关键词前缀来触发，对应配置 <code>image_create_prefix </code></li><li>关于OpenAI对话及图片接口的参数配置（内容自由度、回复字数限制、图片大小等），可以参考 <a href="https://beta.openai.com/docs/api-reference/completions" target="_blank" rel="noreferrer">对话接口</a> 和 <a href="https://beta.openai.com/docs/api-reference/completions" target="_blank" rel="noreferrer">图像接口</a> 文档直接在 <a href="https://github.com/zhayujie/chatgpt-on-wechat/blob/master/bot/openai/open_ai_bot.py" target="_blank" rel="noreferrer">代码</a> <code>bot/openai/open_ai_bot.py</code> 中进行调整。</li><li><code>conversation_max_tokens</code>：表示能够记忆的上下文最大字数（一问一答为一组对话，如果累积的对话字数超出限制，就会优先移除最早的一组对话）</li><li><code>rate_limit_chatgpt</code>，<code>rate_limit_dalle</code>：每分钟最高问答速率、画图速率，超速后排队按序处理。</li><li><code>clear_memory_commands</code>: 对话内指令，主动清空前文记忆，字符串数组可自定义指令别名。</li><li><code>hot_reload</code>: 程序退出后，暂存微信扫码状态，默认关闭。</li><li><code>character_desc</code> 配置中保存着你对机器人说的一段话，他会记住这段话并作为他的设定，你可以为他定制任何人格 (关于会话上下文的更多内容参考该 <a href="https://github.com/zhayujie/chatgpt-on-wechat/issues/43" target="_blank" rel="noreferrer">issue</a>)</li><li><code>subscribe_msg</code>：订阅消息，公众号和企业微信channel中请填写，当被订阅时会自动回复， 可使用特殊占位符。目前支持的占位符有{trigger_prefix}，在程序中它会自动替换成bot的触发词。</li></ul><h2 id="运行" tabindex="-1">运行 <a class="header-anchor" href="#运行" aria-label="Permalink to &quot;运行&quot;">​</a></h2><h3 id="本地运行" tabindex="-1">本地运行 <a class="header-anchor" href="#本地运行" aria-label="Permalink to &quot;本地运行&quot;">​</a></h3><p>如果是开发机本地运行，直接在项目根目录下执行：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> app.py</span></span></code></pre></div><p>或者使用 IDE 运行。</p><p>终端输出如下：</p><p><img src="`+h+'" alt=""></p><p>输出二维码后，使用微信进行扫码，当输出 <code>Start auto replying</code> 时表示自动回复程序已经成功运行了（注意：用于登录的微信需要在支付处已完成实名认证）。 扫码登录后你的账号就成为机器人了。</p><p><img src="'+p+'" alt=""></p><p><img src="'+k+'" alt=""></p><p>可以在微信手机端通过配置的关键词触发自动回复 (任意好友发送消息给你，或是自己发消息给好友)。</p><p><img src="'+s+'" alt=""></p><p><strong>特殊指令</strong>： 用户向机器人发送 <code>#reset</code> 即可清空该用户的上下文记忆。</p><h3 id="docker-部署" tabindex="-1">Docker 部署 <a class="header-anchor" href="#docker-部署" aria-label="Permalink to &quot;Docker 部署&quot;">​</a></h3><p>项目中包含 <code>compose</code> 文件可以直接运行：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -d</span></span></code></pre></div><h3 id="railway部署-✅推荐" tabindex="-1">Railway部署 (✅推荐) <a class="header-anchor" href="#railway部署-✅推荐" aria-label="Permalink to &quot;Railway部署 (✅推荐)&quot;">​</a></h3><blockquote><p>Railway每月提供5刀和最多500小时的免费额度。</p></blockquote><p>可以直接在项目页面点击 <strong>Railway部署</strong> 按钮，使用模板部署。</p><p>也可是 clone 项目然后在新增部署。</p><p>记得配置 <code>open_api_key</code>：</p><p><img src="'+o+'" alt=""></p><p>然后在 Deploy Tab 页找到部署记录，点击 <code>View Logs</code>:</p><p><img src="'+r+`" alt=""></p><h2 id="插件" tabindex="-1">插件 <a class="header-anchor" href="#插件" aria-label="Permalink to &quot;插件&quot;">​</a></h2><p>项目的一大特色就是对插件的支持，当然你也可以实现自己的插件。</p><h3 id="banwords" tabindex="-1">banwords <a class="header-anchor" href="#banwords" aria-label="Permalink to &quot;banwords&quot;">​</a></h3><p>简易的敏感词插件，暂不支持分词，请自行导入词库到插件文件夹中的 <strong>banwords.txt</strong>，每行一个词，一个参考词库是1。</p><p>使用前将<strong>config.json.template</strong>复制为 <strong>config.json</strong>，并自行配置。</p><p>目前插件对消息的默认处理行为有如下两种：</p><ul><li><strong>ignore</strong> : 无视这条消息。</li><li><strong>replace</strong> : 将消息中的敏感词替换成&quot;*&quot;，并回复违规。</li><li></li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;action&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;replace&quot;,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;reply_filter&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> true</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;reply_action&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;ignore&quot;</span></span></code></pre></div><p>在以上配置项中：</p><ul><li>action: 对用户消息的默认处理行为</li><li>reply_filter: 是否对ChatGPT的回复也进行敏感词过滤</li><li>reply_action: 如果开启了回复过滤，对回复的默认处理行为</li></ul><h3 id="bdunit" tabindex="-1">bdunit <a class="header-anchor" href="#bdunit" aria-label="Permalink to &quot;bdunit&quot;">​</a></h3><p>利用百度UNIT实现智能对话</p><ol><li>解决问题：chatgpt无法处理的指令，交给百度UNIT处理如：天气，日期时间，数学运算等</li><li>如问时间：现在几点钟，今天几号</li><li>如问天气：明天广州天气怎么样，这个周末深圳会不会下雨</li><li>如问数学运算：23+45=多少，100-23=多少，35转化为二进制是多少？</li></ol><p>使用说明：</p><p>首先获取 apikey ：</p><p>在百度UNIT官网上自己创建应用，申请百度机器人,可以把预先训练好的模型导入到自己的应用中，</p><p>参考：</p><ul><li><a href="https://ai.baidu.com/unit/home#/home" target="_blank" rel="noreferrer">https://ai.baidu.com/unit/home#/home</a></li><li><a href="https://console.bce.baidu.com/ai%E5%B9%B3%E5%8F%B0%E7%94%B3%E8%AF%B7" target="_blank" rel="noreferrer">https://console.bce.baidu.com/ai平台申请</a></li></ul><p>将文件夹中 <code>config.json.template</code> 复制为 <code>config.json</code>。</p><p>在其中填写百度UNIT官网上获取应用的 API Key 和 Secret Key</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;service_id&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;s...&quot;,</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> #&quot;机器人ID&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;api_key&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;secret_key&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><h3 id="role" tabindex="-1">role <a class="header-anchor" href="#role" aria-label="Permalink to &quot;role&quot;">​</a></h3><p>用于让Bot扮演指定角色的聊天插件，触发方法如下：</p><ul><li><code>$角色/$role help/帮助</code> - 打印目前支持的角色列表。</li><li><code>$角色/$role &lt;角色名&gt;</code> - 让AI扮演该角色，角色名支持模糊匹配。</li><li><code>$停止扮演 </code>- 停止角色扮演。</li><li></li></ul><p>添加自定义角色请在 <code>roles/roles.json</code> 中添加。</p><p>(大部分prompt来自 <a href="https://github.com/rockbenben/ChatGPT-Shortcut/blob/main/src/data/users.tsx" target="_blank" rel="noreferrer">https://github.com/rockbenben/ChatGPT-Shortcut/blob/main/src/data/users.tsx</a> )</p><p>以下为例子:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;写作助理&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;As a writing improvement assistant, your task is to improve the spelling, grammar, clarity, concision, and overall readability of the text I provided, while breaking down long sentences, reducing repetition, and providing suggestions for improvement. Please provide only the corrected Chinese version of the text and avoid including explanations. Please treat every message I send later as text content.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;descn&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;作为一名中文写作改进助理，你的任务是改进所提供文本的拼写、语法、清晰、简洁和整体可读性，同时分解长句，减少重复，并提供改进建议。请只提供文本的更正版本，避免包括解释。请把我之后的每一条消息都当作文本内容。&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;wrapper&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;内容是:</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\n\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">%s</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#8DDB8C;">  &quot;remark&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;最常使用的角色，用于优化文本的语法、清晰度和简洁度，提高可读性。&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><ul><li>title: 角色名。</li><li>description: 使用$role触发时，使用英语prompt。</li><li>descn: 使用$角色触发时，使用中文prompt。</li><li>wrapper: 用于包装用户消息，可起到强调作用，避免回复离题。</li><li>remark: 简短描述该角色，在打印帮助文档时显示。</li></ul><hr><div style="text-align:center;color:#00000099;font-size:14px;">END</div>`,108)]))}const q=a(d,[["render",c]]);export{b as __pageData,q as default};
