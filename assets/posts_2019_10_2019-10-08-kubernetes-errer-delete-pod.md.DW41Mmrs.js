import{_ as s}from"./chunks/aliyun-lbs-listeners.brngfsNt.js";import{_ as a,a as t,af as i,o as n}from"./chunks/framework.C87LdZyP.js";const g=JSON.parse('{"title":"Kubernetes Error delete Pod","description":"","frontmatter":{"title":"Kubernetes Error delete Pod","date":"2019-10-08T00:00:00.000Z","tags":["kubernetes","aliyun"],"category":["DevOps"]},"headers":[],"relativePath":"posts/2019/10/2019-10-08-kubernetes-errer-delete-pod.md","filePath":"posts/2019/10/2019-10-08-kubernetes-errer-delete-pod.md","lastUpdated":1718173059000}'),l={name:"posts/2019/10/2019-10-08-kubernetes-errer-delete-pod.md"};function p(r,e,o,d,h,c){return n(),t("div",null,e[0]||(e[0]=[i(`<p>Aliyun 的 Kubernetes 测试环境 CI 更新的时候，卡住了。</p><p>开始以为是服务器资源不足，后来查看控制台 Pod 的状态：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>error killing pod: [failed to &quot;KillContainer&quot; for &quot;istio-proxy&quot; with KillContainerError: &quot;rpc error: code = Unknown desc = operation timeout: context deadline exceeded&quot; , failed to &quot;KillContainer&quot; for &quot;wms&quot; with KillContainerError: &quot;rpc error: code = Unknown desc = operation timeout: context deadline exceeded&quot; , failed to &quot;KillPodSandbox&quot; for &quot;35ced948-e3af-11e9-aa25-eed95802c543&quot; with KillPodSandboxError: &quot;rpc error: code = DeadlineExceeded desc = context deadline exceeded&quot; ]</span></span></code></pre></div><p>命令行查看</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> kgp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                                READY</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        RESTARTS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">wms-6d7bcb44f6-q2qbx</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                1/2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     Terminating</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">          7d10h</span></span></code></pre></div><p>执行</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kdelp</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> xxx</span></span></code></pre></div><p>删除 Pod，Deployment 和 Service 均无法删除。</p><p>使用命令</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kdelp</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> xxx</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --now</span></span></code></pre></div><p>也不行。</p><p>最后执行</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kdelp</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> xxx</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --grace-period=0</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --force</span></span></code></pre></div><p>停止的 Pod 被删除掉了。</p><p>重新 apply 配置，Pod 的最后5次事件是：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>Error creating load balancer (will retry): failed to ensure load balancer for service loghub/wms: update backend servers: error ensure vgroup: Aliyun API Error: RequestId: 62C1B690-59F7-46B4-8B45-46080E30A129 Status Code: 400 Code: BackendServerRelatedInstanceNumerOverLimit Message: There is backend server has reached to the quota limit number of load balancers that it could be related to.. k8s/32510/wms/loghub/clusterid</span></span>
<span class="line"><span>service-controller</span></span></code></pre></div><p>大致意思是 load balancer 监听的后端已经到了上限，不能再添加了。（</p><p>随便搜了下，没有找个类似错误，在阿里云负载均衡的 <a href="https://error-center.alibabacloud.com/status/product/Slb" target="_blank" rel="noreferrer">API 错误</a> 里面也没有搜索到这个错误。</p><p>进入阿里云负载均衡控制台](<a href="https://slb.console.aliyun.com/slb/cn-hangzhou/slbs" target="_blank" rel="noreferrer">https://slb.console.aliyun.com/slb/cn-hangzhou/slbs</a>) 找到最可以的那一个</p><p><img src="`+s+'" alt=""></p><p>删除了一个不可用的监听，再次 Apply Kubernetes 对象，成功了。</p><p>看了一下帮助，也没有找到</p><hr><p>参考：</p><ul><li><a href="https://stackoverflow.com/questions/50336665/how-do-i-force-delete-kubernetes-pods/50338057" target="_blank" rel="noreferrer">https://stackoverflow.com/questions/50336665/how-do-i-force-delete-kubernetes-pods/50338057</a></li></ul>',25)]))}const b=a(l,[["render",p]]);export{g as __pageData,b as default};
