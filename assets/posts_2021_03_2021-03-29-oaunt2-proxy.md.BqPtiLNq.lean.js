import{_ as i,a,af as t,o as n}from"./chunks/framework.C87LdZyP.js";const o=JSON.parse('{"title":"oauth2-proxy 使用","description":"","frontmatter":{"title":"oauth2-proxy 使用","date":"2021-03-29T00:00:00.000Z","tags":["oauth2-proxy"]},"headers":[],"relativePath":"posts/2021/03/2021-03-29-oaunt2-proxy.md","filePath":"posts/2021/03/2021-03-29-oaunt2-proxy.md","lastUpdated":1718175555000}'),p={name:"posts/2021/03/2021-03-29-oaunt2-proxy.md"};function h(l,s,e,k,r,d){return n(),a("div",null,s[0]||(s[0]=[t(`<ul><li>项目地址： <a href="https://github.com/oauth2-proxy/oauth2-proxy" target="_blank" rel="noreferrer">https://github.com/oauth2-proxy/oauth2-proxy</a></li><li>文档地址： <a href="https://oauth2-proxy.github.io/oauth2-proxy/docs/" target="_blank" rel="noreferrer">https://oauth2-proxy.github.io/oauth2-proxy/docs/</a></li></ul><p>配置过程中经常出现 403 等错误，最终的配置如下：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">./oauth2-proxy</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --provider=gitlab</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --oidc-issuer-url=https://git.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --client-id=d2c4a21ae</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --client-secret=e34c2d566</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --cookie-secret=0Wbf2lcF</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --email-domain=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --upstream=http://127.0.0.1:8080</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --http-address=0.0.0.0:4180</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --cookie-secure=true</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --whitelist-domain=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --cookie-domain=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --redirect-url=http://127.0.0.1:4180/oauth2/callback</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --skip-provider-button=false</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --set-xauthrequest=true</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --skip-auth-preflight=false</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --ssl-insecure-skip-verify</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --pass-access-token=true</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --pass-authorization-header=true</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">        --set-authorization-header=true</span></span></code></pre></div><p>生成 cookie secure 可以使用：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sha256sum</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sha256sum.txt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> 2&gt;&amp;1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OK</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">oauth2-proxy-x.y.z.linux-amd64:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OK</span></span></code></pre></div>`,5)]))}const F=i(p,[["render",h]]);export{o as __pageData,F as default};
