import{_ as s,a as i,o as a,aj as n}from"./chunks/framework.Ba_Ek9Jm.js";const y=JSON.parse('{"title":"（中文）零基础学会使用 LangChain 实现联网和聊天功能","description":"","frontmatter":{"title":"（中文）零基础学会使用 LangChain 实现联网和聊天功能","date":"2023-03-28T00:00:00.000Z","tags":["ai","ml"],"category":["AI"]},"headers":[],"relativePath":"posts/2023/03/2023-03-28-langchain-tour-1.md","filePath":"posts/2023/03/2023-03-28-langchain-tour-1.md","lastUpdated":1718173059000}'),h={name:"posts/2023/03/2023-03-28-langchain-tour-1.md"},t=n(`<blockquote><p>AI 和大语言模型流行的当下，使用大语言模型已经已经成为了一个基本技能， LangChain 可以说是当前编写 LLM 程序的不二之选。 本文带你熟悉 LangChain 的基本概念，并看看怎么实现一个带联网搜索的 LLM 程序。</p></blockquote><h2 id="核心模块" tabindex="-1">核心模块 <a class="header-anchor" href="#核心模块" aria-label="Permalink to &quot;核心模块&quot;">​</a></h2><p>开始之前先介绍下 LangChain 的核心模块， 这些模块是核心抽象，我们将其视为任何 LLM 支持的应用程序的构建块。</p><p>LangChain 为每个模块提供了标准的、可扩展的接口。LangChain 还提供外部集成，甚至是现成使用的端到端实施。</p><p>这些模块分别是（从最少到最复杂）：</p><ul><li><strong>模型 Models</strong>：支持的模型类型和集成。</li><li><strong>提示 Prompts</strong>：提示管理、优化和序列化。</li><li><strong>内存 Memory</strong>：内存是指链/代理调用之间持续存在的状态。</li><li><strong>索引 Indexes</strong>：当与特定于应用程序的数据结合时，语言模型变得更加强大——该模块包含用于加载、查询和更新外部数据的接口和集成。</li><li><strong>链 Chains</strong>：链是结构化的调用序列（对 LLM 或不同的实用程序）。</li><li><strong>代理 Agents</strong>：代理是一个链，其中 LLM 在给定高级指令和一组工具的情况下，反复决定一个动作，执行该动作并观察结果，直到高级指令完成。</li><li><strong>回调 Callbacks</strong>：回调让您可以记录和流式传输任何链的中间步骤，从而便于观察、调试和评估应用程序的内部结构。</li></ul><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><p>直接使用 Pip 安装 LangChain 库：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain</span></span></code></pre></div><h2 id="llm-环境" tabindex="-1">LLM 环境 <a class="header-anchor" href="#llm-环境" aria-label="Permalink to &quot;LLM 环境&quot;">​</a></h2><p>使用 LangChain 通常需要与一个或多个模型提供者、数据存储、API 等集成。</p><p>为了简单起见，我们后面将使用 OpenAI 的 API，所以我们首先需要安装他们的 SDK：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> openai</span></span></code></pre></div><p>然后在终端中设置环境变量：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> OPENAI_API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;...&quot;</span></span></code></pre></div><p>或者（使用 Jupyter notebook（或 Python 脚本））：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> os</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">os.environ[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;OPENAI_API_KEY&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">]</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;...&quot;</span></span></code></pre></div><p>如果要动态设置 API 密钥，可以在启动 OpenAI 类时使用 <code>openai_api_key</code> 参数。</p><p>例如，每个用户的 API 密钥：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.llms</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">llm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(openai_api_key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;YOUR_OPENAI_API_KEY&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><h2 id="使用-llm" tabindex="-1">使用 LLM <a class="header-anchor" href="#使用-llm" aria-label="Permalink to &quot;使用 LLM&quot;">​</a></h2><p>我们首先需要导入 LLM 包装器：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.llms</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span></span></code></pre></div><p>然后我们可以用任何参数初始化包装器。在此示例中，我们可能希望输出更加随机，因此我们将使用高温对其进行初始化。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">llm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0.9</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><blockquote><p>简单来说，<code>temperature</code> 越高，LLM 胡说八道的越厉害。</p></blockquote><p>我们现在调用它：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">text</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;帮我给一家做 AI 服务的科技公司起一个中文名和英文名&quot;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">llm</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">))</span></span></code></pre></div><p>然后他帮我起了一个好俗的名字。。。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">中文名：智能联盟</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">英文名：Intelligent</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Alliance</span></span></code></pre></div><p>在执行一遍，好吧<code>智博科技</code>：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">中文名：智博科技</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">英文名：InteBridge</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Technology</span></span></code></pre></div><h2 id="提示模板的使用" tabindex="-1">提示模板的使用 <a class="header-anchor" href="#提示模板的使用" aria-label="Permalink to &quot;提示模板的使用&quot;">​</a></h2><p>获得和使用LLM是重要的第一步，但这仅仅是个开始。</p><p>通常，当您在应用程序中使用 LLM 时，您不会将用户输入直接发送到 LLM。 相反，您可能正在接受用户输入并构建提示，然后将其发送给 LLM。</p><p>例如，在前面的示例中，我们传入的文本被硬编码为要求一家公司的名称。 在这个假想的服务中，我们想要做的是只接受描述公司所做的用户输入，然后用该信息格式化提示。</p><p>使用 LangChain 很容易做到这一点！</p><p>首先让我们定义提示模板：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.prompts</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> PromptTemplate</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">prompt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> PromptTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    input_variables</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[&quot;product&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;帮我给一家做 {product} 服务的科技公司起一个中文名和英文名&quot;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><blockquote><p>这样的话，我们就可以构建一个 LLM 起名的程序，只要用户输入关键词，就可以返回名称。</p></blockquote><p>现在让我们看看这是如何工作的，我们可以调用该 <code>.format</code> 方法对其进行格式化：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">prompt.format</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">product=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;相册&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">))</span></span></code></pre></div><p>输出是：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">帮我给一家做</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 相册</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 服务的科技公司起一个中文名和英文名</span></span></code></pre></div><h2 id="使用-chain-链接模板和-llm" tabindex="-1">使用 Chain 链接模板和 LLM <a class="header-anchor" href="#使用-chain-链接模板和-llm" aria-label="Permalink to &quot;使用 Chain 链接模板和 LLM&quot;">​</a></h2><p>到目前为止，我们一直在单独使用 PromptTemplate 和 LLM 。但是，当然，真正的应用程序不仅仅是一个类，而是它们的组合。</p><p>LangChain 中的一条链由 Chain 组成，Chain 可以是像 LLM 这样的原始链，也可以是其他链。</p><p>最核心的链类型是 <code>LLMChain</code>，它由 <code>PromptTemplate</code> 和 <code>LLM</code> 组成。</p><p>扩展前面的示例，我们可以构造一个 LLMChain，它接受用户输入，使用 PromptTemplate 对其进行格式化，然后将格式化的响应传递给 LLM。</p><p>这是之前的代码：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.prompts</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> PromptTemplate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.llms</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">llm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0.9</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">prompt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> PromptTemplate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    input_variables</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">[&quot;product&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    template</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;帮我给一家做 {product} 服务的科技公司起一个中文名和英文名&quot;,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>使用 Chain：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.chains</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> LLMChain</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chain</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> LLMChain</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(llm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">llm,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>现在我们可以仅指定产品来运行该链:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chain.run(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;电子音乐&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>输出如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">中文名：节拍音乐</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">英文名：Beats</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Music</span></span></code></pre></div><h2 id="代理" tabindex="-1">代理 <a class="header-anchor" href="#代理" aria-label="Permalink to &quot;代理&quot;">​</a></h2><p>到目前为止，我们所看到的链条以预定的顺序运行。</p><p>代理不再这样做：<strong>他们使用 LLM 来确定采取哪些行动以及采取何种顺序</strong>。动作可以是使用工具并观察其输出，也可以是返回给用户。</p><p>概念对比：</p><ul><li><strong>工具 Tools</strong>：执行特定任务的功能。这可以是：Google 搜索、数据库查找、Python REPL、其他链。工具的接口目前是一个函数，期望将字符串作为输入，将字符串作为输出。</li><li><strong>LLM</strong>：为代理提供支持的语言模型。</li><li><strong>代理 Agents</strong>：要使用的代理。这应该是一个引用支持代理类的字符串。</li></ul><p>我们安装 <code>SerpAPI</code> Python 包，来使用 Google 自定义搜索。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> google-search-results</span></span></code></pre></div><p>并设置环境变量，<code>SERPAPI_API_KEY</code> 可以免费注册获取。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> os</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">os.environ[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;SERPAPI_API_KEY&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">]</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;...&quot;</span></span></code></pre></div><p>下面运行：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.agents</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> load_tools</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.agents</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> initialize_agent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.agents</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AgentType</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.llms</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">llm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#  加载工具</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">tools</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> load_tools</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;serpapi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;llm-math&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">], llm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">llm</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 初始化工具</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">agent</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> initialize_agent</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">tools,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> llm,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> agent=AgentType.ZERO_SHOT_REACT_DESCRIPTION,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> verbose=True</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 测试下</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">agent.run(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;上海昨天的高温是多少度？ 这个数字的 .023 次方是多少&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>可以看到输出：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> I</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> need</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> find</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> out</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> temperature</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Shanghai</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> yesterday</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> then</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> calculate</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> .023</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> power</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> that</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> number</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Action:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Search</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Action</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Input:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;Shanghai temperature yesterday&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Observation:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://www.timeanddate.com/weather/china/shanghai/historic</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Thought:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> I</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> can</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> use</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> calculator</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> calculate</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> .023</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> power</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Action:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Calculator</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Action</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Input:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;Temperature in Shanghai yesterday (34°C) ^ .023&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Observation:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Answer:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.084486162715683</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Thought:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> I</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> now</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> know</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> final</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> answer</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Final</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Answer:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> The</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> .023</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> power</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> temperature</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Shanghai</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> yesterday</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (34°C) is 1.084486162715683.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Finished chain.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> .023</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> power</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> temperature</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Shanghai</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> yesterday</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (34°C) is 1.084486162715683.</span></span></code></pre></div><h2 id="内存的使用" tabindex="-1">内存的使用 <a class="header-anchor" href="#内存的使用" aria-label="Permalink to &quot;内存的使用&quot;">​</a></h2><p>到目前为止，我们所经历的所有链和代理都是无状态的。但通常，您可能希望链或代理具有某种“记忆”概念，以便它可以记住有关其先前交互的信息。 最清晰和简单的例子是在设计聊天机器人时——您希望它记住以前的消息， 以便它可以使用来自该消息的上下文来进行更好的对话。 这将是一种“短期记忆”。</p><p>LangChain 专门为此提供了几个专门创建的链。</p><p>默认情况下，<code>ConversationChain</code> 有一种简单类型的内存， 可以记住所有以前的输入/输出并将它们添加到传递的上下文中。 让我们来看看使用这个链（设置<code>verbose=True</code>以便我们可以看到提示）。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ConversationChain</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">llm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">conversation</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ConversationChain</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(llm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">llm,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> verbose</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">output</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> conversation.predict</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(input</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;你好&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">output</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>输出为：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Prompt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> after</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> formatting:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> following</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> friendly</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> conversation</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> between</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> human</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> an</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AI.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> The</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AI</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> talkative</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> provides</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lots</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> specific</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> details</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> its</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> context.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> If</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AI</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> does</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> know</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> answer</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> question,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> it</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> truthfully</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> says</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> it</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> does</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> know.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Current</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> conversation:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Human:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 你好</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">AI:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Finished chain.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> 你好！很高兴见到你！我是一个智能AI，我可以回答你的问题，或者我们可以聊聊天？</span></span></code></pre></div><p>继续聊天：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">output</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> conversation.predict</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(input</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;我正在跟 AI 聊天呢。&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">output</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>输出是：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Prompt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> after</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> formatting:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> following</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> friendly</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> conversation</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> between</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> human</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> an</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AI.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> The</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AI</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> talkative</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> provides</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lots</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> specific</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> details</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> its</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> context.</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> If</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AI</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> does</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> know</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> answer</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> question,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> it</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> truthfully</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> says</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> it</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> does</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> know.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Current</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> conversation:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Human:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 你好</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">AI:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  你好！很高兴见到你！我是一个智能AI，我可以回答你的问题，或者我们可以聊聊天？</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Human:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 我正在跟</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AI</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 聊天呢。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">AI:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> Finished chain.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> 哦，真的吗？这太棒了！我很高兴能和你聊天！有什么可以帮助你的吗？</span></span></code></pre></div><h2 id="聊天模型" tabindex="-1">聊天模型 <a class="header-anchor" href="#聊天模型" aria-label="Permalink to &quot;聊天模型&quot;">​</a></h2><p>聊天模型 同样，您可以使用聊天模型而不是 LLM。<strong>聊天模型是语言模型的变体</strong>。 虽然聊天模型在底层使用语言模型，但它们公开的接口有点不同：它们公开的不是“文本输入、文本输出”API，而是“聊天消息”作为输入和输出的接口。</p><p>您可以通过将一条或多条消息传递给聊天模型来获得聊天完成，响应也是一条消息。</p><p>LangChain 目前支持的消息类型有 <code>AIMessage</code>, <code>HumanMessage</code>, <code>SystemMessage</code>, 和 <code>ChatMessage–ChatMessage</code> 。</p><p>大多数时候，您只会处理 <code>HumanMessage</code>、<code>AIMessage</code> 和 <code>SystemMessage</code>。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.chat_models</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatOpenAI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.schema</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    AIMessage,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    HumanMessage,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    SystemMessage</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatOpenAI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>传递一条消息来使用他。</p><p>让它把一句话翻译成中文：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chat([HumanMessage(content</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;Translate this sentence from English to Chinese. I love programming.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)])</span></span></code></pre></div><p>结果如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">AIMessage(lc_kwargs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">={</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">content</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢编程。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;}, content=&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢编程。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;, additional_kwargs={}, example=False)</span></span></code></pre></div><p>一次传入多条消息：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">messages</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    SystemMessage(content</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;You are a helpful assistant that translates Chinese to English.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    HumanMessage(content</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;我喜欢编程。&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chat(messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>输出是：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>AIMessage(lc_kwargs={&#39;content&#39;: &#39;&quot;I like programming.&quot;&#39;}, content=&#39;&quot;I like programming.&quot;&#39;, additional_kwargs={}, example=False)</span></span></code></pre></div><p>一次使用多组消息，</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">batch_messages</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        SystemMessage(content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;You are a helpful assistant that translates English to Chinese.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        HumanMessage(content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;I love programming.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    ]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        SystemMessage(content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;You are a helpful assistant that translates English to Chinese.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        HumanMessage(content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;I love artificial intelligence.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    ]</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">result</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> chat.generate</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">batch_messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">result</span></span></code></pre></div><p>返回如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">LLMResult(generations</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=[[ChatGeneration</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">lc_kwargs={</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: AIMessage(lc_kwargs={&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">content</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢编程。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;}, content=&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢编程。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;, additional_kwargs={}, example=False)}, text=&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢编程。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;, generation_info=None, message=AIMessage(lc_kwargs={&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">content</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢编程。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;}, content=&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢编程。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;, additional_kwargs={}, example=False))], [ChatGeneration(lc_kwargs={&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">message</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: AIMessage(lc_kwargs={&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">content</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢人工智能。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;}, content=&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢人工智能。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;, additional_kwargs={}, example=False)}, text=&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢人工智能。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;, generation_info=None, message=AIMessage(lc_kwargs={&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">content</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢人工智能。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;}, content=&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢人工智能。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;, additional_kwargs={}, example=False))]], llm_output={&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">token_usage</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: {&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">prompt_tokens</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: 57, &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">completion_tokens</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: 19, &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">total_tokens</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: 76}, &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">model_name</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">gpt-3.5-turbo</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;}, run=RunInfo(run_id=UUID(&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">7212ce06-5e1f-43d7-8e12-498d977e1e3a</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;)))</span></span></code></pre></div><p>如果想查看令牌的使用情况，可以：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">result.llm_output[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;token_usage&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">]</span></span></code></pre></div><p>输出是：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;prompt_tokens&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 57,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;completion_tokens&#39;:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 19,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;total_tokens&#39;:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 76</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">}</span></span></code></pre></div><h2 id="聊天提示模板-messageprompttemplate" tabindex="-1">聊天提示模板 MessagePromptTemplate <a class="header-anchor" href="#聊天提示模板-messageprompttemplate" aria-label="Permalink to &quot;聊天提示模板 MessagePromptTemplate&quot;">​</a></h2><p>您可以使用 <code>ChatPromptTemplate</code> 的 <code>format_prompt–</code> 这将返回一个 <code>PromptValue</code>， 您可以将其转换为字符串或 <code>Message </code>对象， 具体取决于您是否要将格式化值用作 llm 或聊天模型的输入。</p><p>为方便起见，<code>from_template</code> 模板上公开了一个方法。如果您要使用此模板，可以这样：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.chat_models</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatOpenAI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.prompts.chat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    ChatPromptTemplate,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    SystemMessagePromptTemplate,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    HumanMessagePromptTemplate,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatOpenAI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">template</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;You are a helpful assistant that translates {input_language} to {output_language}.&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">system_message_prompt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> SystemMessagePromptTemplate.from_template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">human_template</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;{text}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">human_message_prompt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> HumanMessagePromptTemplate.from_template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">human_template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chat_prompt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatPromptTemplate.from_messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([system_message_prompt, human_message_prompt])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># get a chat completion from the formatted messages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chat(chat_prompt.format_prompt(input_language</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;English&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> output_language=&quot;Chinese&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> text=&quot;I love programming.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">.to_messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">())</span></span></code></pre></div><p>输出如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">AIMessage(lc_kwargs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">={</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">content</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;: &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢编程。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;}, content=&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢编程。</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;, additional_kwargs={}, example=False)</span></span></code></pre></div><h2 id="聊天模型和-chain-一起使用" tabindex="-1">聊天模型和 Chain 一起使用 <a class="header-anchor" href="#聊天模型和-chain-一起使用" aria-label="Permalink to &quot;聊天模型和 Chain 一起使用&quot;">​</a></h2><p>直接看代码：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.chat_models</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatOpenAI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> LLMChain</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.prompts.chat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    ChatPromptTemplate,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    SystemMessagePromptTemplate,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    HumanMessagePromptTemplate,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatOpenAI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">template</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;You are a helpful assistant that translates {input_language} to {output_language}.&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">system_message_prompt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> SystemMessagePromptTemplate.from_template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">human_template</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;{text}&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">human_message_prompt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> HumanMessagePromptTemplate.from_template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">human_template</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chat_prompt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatPromptTemplate.from_messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([system_message_prompt, human_message_prompt])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chain</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> LLMChain</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(llm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">chat,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">chat_prompt</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chain.run(input_language</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;English&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> output_language=&quot;Chinese&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> text=&quot;I love programming.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>输出如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">我喜欢编程。</span></span></code></pre></div><h2 id="具有聊天模型的代理" tabindex="-1">具有聊天模型的代理 <a class="header-anchor" href="#具有聊天模型的代理" aria-label="Permalink to &quot;具有聊天模型的代理&quot;">​</a></h2><p>代理也可以与聊天模型一起使用，您可以初始化一个 <code>AgentType.CHAT_ZERO_SHOT_REACT_DESCRIPTION</code> 作为代理类型。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.agents</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> load_tools</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.agents</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> initialize_agent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.agents</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AgentType</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.chat_models</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatOpenAI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.llms</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">chat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatOpenAI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">llm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> OpenAI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">tools</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> load_tools</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;serpapi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;llm-math&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">], llm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">llm</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">agent</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> initialize_agent</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">tools,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> chat,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> agent=AgentType.CHAT_ZERO_SHOT_REACT_DESCRIPTION,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> verbose=True</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">agent.run(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;迪丽热巴出演过几次电影？ 这个数字乘以她当前年龄的 0.23 次幂是多少？&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>输出如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Question:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 迪丽热巴出演过几次电影？</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 这个数字乘以她当前年龄的</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.23</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 次幂是多少？</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Thought:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> I</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> need</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> use</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> search</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> engine</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> find</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> out</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> how</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> many</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> movies</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Dilraba</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Dilmurat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> has</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> acted</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> then</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> use</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> calculator</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> perform</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> necessary</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> calculations.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Action:</span></span></code></pre></div><p>{ &quot;action&quot;: &quot;Search&quot;, &quot;action_input&quot;: &quot;Dilraba Dilmurat movies&quot; }</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Observation: Dilraba Dilmurat, known mononymously as Dilireba, is a Chinese actress, singer and model of Uyghur ethnicity.</span></span>
<span class="line"><span>Thought:Now I need to search for the number of movies Dilraba Dilmurat has acted in and her current age.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Action:</span></span></code></pre></div><p>{ &quot;action&quot;: &quot;Search&quot;, &quot;action_input&quot;: &quot;Dilraba Dilmurat number of movies and age&quot; }</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Observation: Dilraba Dilmurat (Uyghur: دىلرەبا دىلمۇرات; born June 3, 1992), known mononymously as ... In 2018, Dilraba starred in the romantic comedy film 21 Karat.</span></span>
<span class="line"><span>Thought:I now have the information I need to calculate the answer. I will use a calculator to perform the necessary calculations.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Action:</span></span></code></pre></div><p>{ &quot;action&quot;: &quot;Calculator&quot;, &quot;action_input&quot;: &quot;21^0.23 * 29&quot; }</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Observation: Answer: 58.412855303074444</span></span>
<span class="line"><span>Thought:The final answer is 58.412855303074444.</span></span>
<span class="line"><span>Final Answer: 58.412855303074444</span></span>
<span class="line"><span></span></span>
<span class="line"><span>&gt; Finished chain.</span></span>
<span class="line"><span>58.412855303074444</span></span></code></pre></div><h2 id="使用内存-代码和链" tabindex="-1">使用内存+代码和链 <a class="header-anchor" href="#使用内存-代码和链" aria-label="Permalink to &quot;使用内存+代码和链&quot;">​</a></h2><p>还可以将内存与使用聊天模型初始化的链和代理一起使用。</p><p>这与 LLM Memory 的主要区别在于， 我们可以将它们保留为自己唯一的内存对象， 而不是试图将所有以前的消息压缩成一个字符串。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.prompts</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    ChatPromptTemplate,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    MessagesPlaceholder,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    SystemMessagePromptTemplate,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    HumanMessagePromptTemplate</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.chains</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ConversationChain</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.chat_models</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatOpenAI</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> langchain.memory</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ConversationBufferMemory</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">prompt</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatPromptTemplate.from_messages</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">([</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    SystemMessagePromptTemplate.from_template(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;The following is a friendly conversation between a human and an AI. The AI is talkative and provides lots of specific details from its context. If the AI does not know the answer to a question, it truthfully says it does not know.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    MessagesPlaceholder(variable_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;history&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    HumanMessagePromptTemplate.from_template(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;{input}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">llm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ChatOpenAI</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(temperature</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">memory</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ConversationBufferMemory</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(return_messages</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">conversation</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ConversationChain</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(memory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">memory,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> prompt</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">prompt,</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> llm</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">llm</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">conversation.predict(input</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;你好&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>输出为：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">你好！我是一名AI语言模型，很高兴能和你交流。有什么我可以帮助你的吗？</span></span></code></pre></div><p>继续聊天：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">conversation.predict(input</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;我正在和 AI 聊天&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>输出为：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">是的，你正在和我这个AI语言模型聊天。我可以回答你的问题，提供信息，或者只是和你闲聊。有什么你想问我的吗？</span></span></code></pre></div><p>继续：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">conversation.predict(input</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;介绍下你自己&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">当然可以！我是一名AI语言模型，由OpenAI公司开发。我被训练来理解和生成自然语言，可以用来回答问题、提供信息、生成文本等等。我使用的技术是深度学习，通过大量的数据和算法来学习自然语言的规律和模式。虽然我只是一种人工智能，但我可以模拟人类的思维和语言能力，帮助人们解决问题和交流。</span></span></code></pre></div><p>继续：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">conversation.predict(input</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;我刚才在干嘛&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">您刚才说了一句中文：“我正在和</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AI</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 聊天”。我猜您可能是想测试一下我的中文能力，或者只是想和我打个招呼。不过，无论您的目的是什么，我都很高兴能够和您交流。</span></span></code></pre></div><h2 id="结语" tabindex="-1">结语 <a class="header-anchor" href="#结语" aria-label="Permalink to &quot;结语&quot;">​</a></h2><p>到现在位置，LangChain 的所有主要概念，都已经讲完。</p><p>上面的代码已经足够让你完成一个 联网的聊天引擎后端。</p><p>后面我在更新一片教程，跟大家介绍下如何 Gradio 来从零开始写一个聊天界面。</p><hr><div style="text-align:center;color:#00000099;font-size:14px;">END</div>`,148),l=[t];function p(e,k,F,d,r,g){return a(),i("div",null,l)}const c=s(h,[["render",p]]);export{y as __pageData,c as default};
