import{_ as a,a as i,af as n,o as e}from"./chunks/framework.C87LdZyP.js";const p="/assets/chart-types.CPg-n-01.png",g=JSON.parse('{"title":"Davinci 二次开发 1 - 环境安装","description":"","frontmatter":{"title":"Davinci 二次开发 1 - 环境安装","date":"2021-03-02T00:00:00.000Z","tags":["davinci","bi"]},"headers":[],"relativePath":"posts/2021/03/2021-03-02-davinci-01-install.md","filePath":"posts/2021/03/2021-03-02-davinci-01-install.md","lastUpdated":1718175555000}'),t={name:"posts/2021/03/2021-03-02-davinci-01-install.md"};function l(h,s,d,c,o,r){return e(),i("div",null,s[0]||(s[0]=[n(`<h2 id="下载项目" tabindex="-1">下载项目 <a class="header-anchor" href="#下载项目" aria-label="Permalink to &quot;下载项目&quot;">​</a></h2><p>可参考<a href="https://edp963.github.io/davinci/docs/zh/1.1-deployment" target="_blank" rel="noreferrer">文档</a></p><h2 id="前端" tabindex="-1">前端 <a class="header-anchor" href="#前端" aria-label="Permalink to &quot;前端&quot;">​</a></h2><p>前端安装，使用<code>yarn</code>安装出错，未关心其原因，后使用 cnpm 安装。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>[4/5] 🔗  Linking dependencies...</span></span>
<span class="line"><span>[5/5] 🔨  Building fresh packages...</span></span>
<span class="line"><span>[8/13] ⠈ pngquant-bin</span></span>
<span class="line"><span>[6/13] ⠈ mozjpeg</span></span>
<span class="line"><span>[9/13] ⠈ cwebp-bin</span></span>
<span class="line"><span>[7/13] ⠈ optipng-bin</span></span>
<span class="line"><span>error /Users/.../davinci/webapp/node_modules/gifsicle: Command failed.</span></span>
<span class="line"><span>Exit code: 1</span></span>
<span class="line"><span>Command: node lib/install.js</span></span>
<span class="line"><span>Arguments:</span></span>
<span class="line"><span>Directory: /Users/.../davinci/webapp/node_modules/gifsicle</span></span>
<span class="line"><span>Output:</span></span>
<span class="line"><span>⚠ connect ECONNREFUSED 0.0.0.0:443</span></span>
<span class="line"><span>  ⚠ gifsicle pre-build test failed</span></span>
<span class="line"><span>  ℹ compiling from source</span></span>
<span class="line"><span>  ✖ Error: Command failed: /bin/sh -c autoreconf -ivf</span></span>
<span class="line"><span>/bin/sh: autoreconf: command not found</span></span></code></pre></div><p>使用 <code>cnpm start</code> 启动访问 <a href="http://127.0.0.1:5002" target="_blank" rel="noreferrer"> http://127.0.0.1:5002</a>，由于没有后端，过了很久之后出现登录界面。</p><h2 id="后端" tabindex="-1">后端 <a class="header-anchor" href="#后端" aria-label="Permalink to &quot;后端&quot;">​</a></h2><h3 id="配置环境变量" tabindex="-1">配置环境变量 <a class="header-anchor" href="#配置环境变量" aria-label="Permalink to &quot;配置环境变量&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>export DAVINCI3_HOME=~/app/davinci/davinci-assembly_3.0.1-0.3.0-SNAPSHOT-dist</span></span></code></pre></div><h3 id="创建数据库并导入数据" tabindex="-1">创建数据库并导入数据 <a class="header-anchor" href="#创建数据库并导入数据" aria-label="Permalink to &quot;创建数据库并导入数据&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>mysql -P 3306 -h localhost -u root -proot davinci0.3 &lt; $DAVINCI3_HOME/bin/davinci.sql</span></span></code></pre></div><p>或者执行脚本初始化数据库：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>sh bin/initdb.sh</span></span></code></pre></div><p>然后修改 <code>davinci/config/application.yml</code> 的数据库链接。</p><h3 id="修正jdk版本" tabindex="-1">修正JDK版本 <a class="header-anchor" href="#修正jdk版本" aria-label="Permalink to &quot;修正JDK版本&quot;">​</a></h3><p>运行程序提示</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>/Users/.../davinci/server/src/main/java/edp/core/utils/FileUtils.java:23:32</span></span>
<span class="line"><span>java: package com.sun.image.codec.jpeg does not exist</span></span></code></pre></div><p><code>com.sun.image.codec.jpeg</code> 已经在 java 7 中移除，</p><p>修改</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">JPEGImageEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> encoder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> JPEGCodec.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">createJPEGEncoder</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(output);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">encoder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">encode</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(img_dest);</span></span></code></pre></div><p>为：</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> img_dest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">ImageIO.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(img_dest, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;jpeg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, output);</span></span></code></pre></div><p>去掉这两个引用。</p><h3 id="其他错误" tabindex="-1">其他错误 <a class="header-anchor" href="#其他错误" aria-label="Permalink to &quot;其他错误&quot;">​</a></h3><h4 id="类找不到" tabindex="-1">类找不到 <a class="header-anchor" href="#类找不到" aria-label="Permalink to &quot;类找不到&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>NoClassDefFoundError: Could not initialize class org.hibernate.validator.internal.engine.valueextraction.ValueExtractorManager</span></span></code></pre></div><p>初步判定是依赖问题，为了以后二次开发方便，把常用的库都升级到最新版本：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>springboot: 2.4.3</span></span>
<span class="line"><span>spring-boot-starter-oauth2-client: 2.4.3</span></span>
<span class="line"><span>druid； 1.2.5</span></span>
<span class="line"><span>mybatis-spring-boot-starter: 2.1.4</span></span></code></pre></div><p>增加 <code>org.springframework.boot:spring-boot-starter-validation</code> 的依赖。</p><h3 id="启动" tabindex="-1">启动 <a class="header-anchor" href="#启动" aria-label="Permalink to &quot;启动&quot;">​</a></h3><p>默认用户是 guest/123456，也可以新建一个用户。（如果不想配置邮件服务可以修改 CheckConfigRunner 的逻辑）</p><p>登录 <code>http://127.0.0.1:5002/</code> 即可以访问。</p><h2 id="测试开发" tabindex="-1">测试开发 <a class="header-anchor" href="#测试开发" aria-label="Permalink to &quot;测试开发&quot;">​</a></h2><p>参考 <a href="https://dumplingbao.github.io/2020/03/19/davinci-dev-bmap/" target="_blank" rel="noreferrer">diss带码</a> 的教程，做一个开发试试</p><p>index.html</p><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;text/javascript&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6CB6FF;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;//api.map.baidu.com/api?type=webgl&amp;v=1.0&amp;ak=您的密钥&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt;</span></span></code></pre></div><p>davinci/webapp/app/containers/Widget/config/chart/bmap.ts</p><div class="language-tsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">tsx</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> IChartInfo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  id: ChartTypes.BMap,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;bmap&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  title: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;百度地图&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  icon: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;icon-china&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// 图标先用原来的中国地图</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  coordinate: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;cartesian&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  rules: [{ dimension: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">9999</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">], metric: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  dimetionAxis: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;col&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>ChartTypes.ts</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">  /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">   * 百度地图</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">   */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  BMap </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 18</span></span></code></pre></div><p><code>davinci/webapp/app/containers/Widget/config/chart/index.tsx</code>增加 bmap 的引用，并添加到 chart 对象里面。</p><p>刷新应用就可以看到我们的类型里面增加了百度地图，</p><p><img src="`+p+'" alt=""></p>',43)]))}const u=a(t,[["render",l]]);export{g as __pageData,u as default};
