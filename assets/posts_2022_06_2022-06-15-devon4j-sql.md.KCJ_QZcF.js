import{_ as s,a as i,o as a,aj as h}from"./chunks/framework.Ba_Ek9Jm.js";const g=JSON.parse('{"title":"Devon4j: SQL","description":"","frontmatter":{"title":"Devon4j: SQL","date":"2022-06-15T00:00:00.000Z","tags":["devon4j"],"category":["架构"]},"headers":[],"relativePath":"posts/2022/06/2022-06-15-devon4j-sql.md","filePath":"posts/2022/06/2022-06-15-devon4j-sql.md","lastUpdated":1718173059000}'),k={name:"posts/2022/06/2022-06-15-devon4j-sql.md"},n=h(`<p>有关处理或避免 SQL、防止 SQL 注入等的一般指南，您应该研究 <a href="https://devonfw.com/website/pages/docs/devonfw-guide_devon4j.wiki_guide-domain-layer.asciidoc.html" target="_blank" rel="noreferrer">domain layer</a>。</p><h2 id="命名约定" tabindex="-1">命名约定 <a class="header-anchor" href="#命名约定" aria-label="Permalink to &quot;命名约定&quot;">​</a></h2><p>在这里，我们定义了编写 SQL 文件时应遵循的命名约定：</p><ul><li>大写的所有 SQL 关键字</li><li>按照 devonfw 对每种格式的建议，缩进应该是 2 个空格。</li></ul><h3 id="ddl" tabindex="-1">DDL <a class="header-anchor" href="#ddl" aria-label="Permalink to &quot;DDL&quot;">​</a></h3><p>数据库结构（表、列、触发器、约束等）的命名约定应与您的数据库产品及其运算符保持一致。但是，当您有选择的自由和现代区分大小写的数据库时，您可以简单地将代码约定也用于数据库构造，以避免显式映射每个属性（例如<code>RestaurantTable</code>vs. <code>RESTAURANT_TABLE</code>）。</p><ul><li>在创建表的语句中内联定义列和约束</li><li>缩进列类型，使它们都从同一个文本列开始</li><li>约束应显式命名（以获得合理的提示错误消息）： <ul><li><code>PK_«table»</code>用于主键（此处名称可选，因为 PK 约束是基本的）</li><li><code>FK_«table»_«property»</code>用于外键（<code>«table»</code>和<code>«property»</code>都在定义外键的源上）</li><li><code>UC_«table»_«property»[_«propertyN»]*</code>用于 unique 约束</li><li><code>CK_«table»_«check»</code>用于检查约束（<code>«check»</code>描述检查，如果它是在单个属性上定义的，它应该以该属性开头）。</li></ul></li><li>旧的 RDBMS 对名称有严格的限制（例如 30 个字符）。请注意，最近的数据库已经克服了这个非常低的长度限制。但是，请保持您的名称简短而准确，并尝试在您的项目中为根据（业务）术语定义常见的缩写。特别是不要只在限制处截断名称。</li><li>如果可能，请在表和列上添加注释以帮助 DBA 理解您的架构。许多工具（不仅是 DBA 工具）也尊重这一点。</li></ul><p>下面是一个 DDL 的简短示例：</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> SEQUENCE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> HIBERNATE_SEQUENCE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> START</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> WITH</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1000000</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- *** Table ***</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> RESTAURANT_TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ID                   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">NUMBER</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">19</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  MODIFICATION_COUNTER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INTEGER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  SEATS                </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INTEGER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  CONSTRAINT</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> PK_TABLE </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(ID)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">COMMENT ON TABLE RESTAURANT_TABLE IS </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;The physical tables inside the restaurant.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">-- *** Order ***</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> RESTAURANT_ORDER</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ID                   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">NUMBER</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">19</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  MODIFICATION_COUNTER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INTEGER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  TABLE_ID             </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">NUMBER</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">19</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  TOTAL                </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">DECIMAL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  CREATION_DATE        </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">TIMESTAMP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  PAYMENT_DATE         </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">TIMESTAMP</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  STATUS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">               VARCHAR2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">10</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> CHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  CONSTRAINT</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> PK_ORDER </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(ID),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">  CONSTRAINT</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> FK_ORDER_TABLE_ID </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">FOREIGN KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(TABLE_ID) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">REFERENCES</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RESTAURANT_TABLE(ID)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">COMMENT ON TABLE RESTAURANT_ORDER IS </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;An order and bill at the restaurant.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">...</span></span></code></pre></div><p>注意：请注意<code>TABLE</code>and<code>ORDER</code>是 SQL 中的保留关键字，应避免使用此类关键字以防止出现问题。</p><h3 id="数据" tabindex="-1">数据 <a class="header-anchor" href="#数据" aria-label="Permalink to &quot;数据&quot;">​</a></h3><p>对于数据的插入、更新、删除等，SQL 脚本还应遵循以下准则：</p><ul><li>在每个表的块中插入总是具有相同的列顺序。</li><li>插入列值始终以 ID、MODIFICATION_COUNTER、[DTYPE、] …</li><li>在具有自由文本的列之前列出具有固定长度值（布尔值、数字、枚举等）的列，以支持多个插入语句的对齐</li><li>专业提示：熟悉高级编辑器的列模式，例如<code>notepad++</code>在编辑大块类似的插入语句时。</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RESTAURANT_TABLE(ID, MODIFICATION_COUNTER, SEATS) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RESTAURANT_TABLE(ID, MODIFICATION_COUNTER, SEATS) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RESTAURANT_TABLE(ID, MODIFICATION_COUNTER, SEATS) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RESTAURANT_TABLE(ID, MODIFICATION_COUNTER, SEATS) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RESTAURANT_TABLE(ID, MODIFICATION_COUNTER, SEATS) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RESTAURANT_TABLE(ID, MODIFICATION_COUNTER, SEATS) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RESTAURANT_TABLE(ID, MODIFICATION_COUNTER, SEATS) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RESTAURANT_TABLE(ID, MODIFICATION_COUNTER, SEATS) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">INSERT INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> RESTAURANT_TABLE(ID, MODIFICATION_COUNTER, SEATS) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">...</span></span></code></pre></div><p>另请参见<a href="https://devonfw.com/website/pages/docs/devonfw-guide_devon4j.wiki_guide-database-migration.asciidoc.html" target="_blank" rel="noreferrer">数据库迁移</a>。</p>`,15),l=[n];function p(t,e,A,d,r,C){return a(),i("div",null,l)}const D=s(k,[["render",p]]);export{g as __pageData,D as default};
