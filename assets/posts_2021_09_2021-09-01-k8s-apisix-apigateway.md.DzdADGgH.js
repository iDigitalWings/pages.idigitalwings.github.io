import{_ as i,a,af as t,o as n}from"./chunks/framework.C87LdZyP.js";const g=JSON.parse('{"title":"ApiSix Kubernetes","description":"","frontmatter":{"title":"ApiSix Kubernetes","date":"2021-09-08T00:00:00.000Z","tags":["apisix","k8s"],"category":["运维"]},"headers":[],"relativePath":"posts/2021/09/2021-09-01-k8s-apisix-apigateway.md","filePath":"posts/2021/09/2021-09-01-k8s-apisix-apigateway.md","lastUpdated":1718173059000}'),h={name:"posts/2021/09/2021-09-01-k8s-apisix-apigateway.md"};function p(l,s,e,k,F,d){return n(),a("div",null,s[0]||(s[0]=[t(`<h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bitnami</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://charts.bitnami.com/bitnami</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> repo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> update</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://github.com/apache/apisix-helm-chart.git</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apisix-helm-chart</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ns</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ingress-apisix</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># install apisix</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apisix</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> charts/apisix</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> gateway.type=LoadBalancer</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ingress-controller.enabled=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd.persistence.storageClass=&quot;alicloud-disk-ssd&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> etcd.persistence.size=&quot;20Gi&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">  --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ingress-apisix</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># show apisix</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> get</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ingress-apisix</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> svc</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apisix-gateway</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># install dashboard</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apisix-dashboard</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> charts/apisix-dashboard</span></span></code></pre></div><h3 id="卸载" tabindex="-1">卸载 <a class="header-anchor" href="#卸载" aria-label="Permalink to &quot;卸载&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> uninstall</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apisix-dashboard</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">helm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> uninstall</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apisix</span></span></code></pre></div><h2 id="查看-apisix" tabindex="-1">查看 apisix <a class="header-anchor" href="#查看-apisix" aria-label="Permalink to &quot;查看 apisix&quot;">​</a></h2><p>NOTE: It may take a few minutes for the LoadBalancer IP to be available. You can watch the status of by running &#39;kubectl get --namespace ingress-apisix svc -w apisix-gateway&#39;</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> SERVICE_IP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> svc</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ingress-apisix</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> apisix-gateway</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --template</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> http://</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$SERVICE_IP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">:80</span></span></code></pre></div><h2 id="使用-dashboard" tabindex="-1">使用 dashboard <a class="header-anchor" href="#使用-dashboard" aria-label="Permalink to &quot;使用 dashboard&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> APISIX_POD_NAME</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pods</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ingress-apisix</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;app.kubernetes.io/name=apisix-dashboard,app.kubernetes.io/instance=apisix-dashboard&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> jsonpath=&quot;{.items[0].metadata.name}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> APISIX_CONTAINER_PORT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pod</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ingress-apisix</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $APISIX_POD_NAME </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">-o</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> jsonpath=&quot;{.spec.containers[0].ports[0].containerPort}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;Visit http://127.0.0.1:8080 to use your application&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ingress-apisix</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> port-forward</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> $APISIX_POD_NAME </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">8080:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$APISIX_CONTAINER_PORT</span></span></code></pre></div>`,9)]))}const o=i(h,[["render",p]]);export{g as __pageData,o as default};
