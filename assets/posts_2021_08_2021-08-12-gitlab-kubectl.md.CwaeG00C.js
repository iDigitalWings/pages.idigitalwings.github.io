import{_ as s,a as i,o as a,aj as t}from"./chunks/framework.Ba_Ek9Jm.js";const y=JSON.parse('{"title":"Gitlab CI Kubernetes 发布","description":"","frontmatter":{"title":"Gitlab CI Kubernetes 发布","date":"2021-08-13T00:00:00.000Z","tags":["gitlab","kubernetes"],"category":["运维"]},"headers":[],"relativePath":"posts/2021/08/2021-08-12-gitlab-kubectl.md","filePath":"posts/2021/08/2021-08-12-gitlab-kubectl.md","lastUpdated":1718173059000}'),e={name:"posts/2021/08/2021-08-12-gitlab-kubectl.md"},n=t(`<p>设置<code>KUBE_CONFIG</code>变量，可以在 Gitlab CI/CD 的 Variables。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ~/.kube/config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> base64</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> pbcopy</span></span></code></pre></div><p>编辑 <code>.gitlab-ci.yml</code>：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">deploy</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  stage</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">deploy</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  image</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">bitnami/kubectl:1.19.14</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  before_script</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;echo \${KUBE_CONFIG} | base64 -d &gt; \${KUBE_CONFIG_FILE}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;cat \${KUBE_CONFIG_FILE}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;kubectl config use-context &lt;context&gt;&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  script</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">kubectl set env deployment &lt;deployment&gt; DEPLOY_DATE=&quot;$(date)&quot; --namespace &lt;namespace&gt;</span></span></code></pre></div>`,4),l=[n];function p(h,k,d,c,o,r){return a(),i("div",null,l)}const b=s(e,[["render",p]]);export{y as __pageData,b as default};
