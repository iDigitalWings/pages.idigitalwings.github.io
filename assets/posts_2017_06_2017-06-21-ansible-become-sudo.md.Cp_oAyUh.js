import{_ as a,a as i,af as e,o as n}from"./chunks/framework.C87LdZyP.js";const c=JSON.parse('{"title":"Ansible: Become(sudo)","description":"","frontmatter":{"title":"Ansible: Become(sudo)","date":"2017-06-21T00:00:00.000Z","tags":["ansible"],"category":["DevOps"]},"headers":[],"relativePath":"posts/2017/06/2017-06-21-ansible-become-sudo.md","filePath":"posts/2017/06/2017-06-21-ansible-become-sudo.md","lastUpdated":1718193786000}'),t={name:"posts/2017/06/2017-06-21-ansible-become-sudo.md"};function l(p,s,h,o,k,d){return n(),i("div",null,s[0]||(s[0]=[e(`<p><a href="http://docs.ansible.com/ansible/become.html" target="_blank" rel="noreferrer">文档</a></p><p><a href="http://docs.ansible.com/ansible/playbooks.html" target="_blank" rel="noreferrer">http://docs.ansible.com/ansible/playbooks.html</a></p><p><a href="http://docs.ansible.com/ansible/intro_configuration.html#ask-sudo-pass" target="_blank" rel="noreferrer">http://docs.ansible.com/ansible/intro_configuration.html#ask-sudo-pass</a></p><p><a href="http://docs.ansible.com/ansible/playbooks_intro.html" target="_blank" rel="noreferrer">http://docs.ansible.com/ansible/playbooks_intro.html</a></p><h2 id="inventory" tabindex="-1">inventory <a class="header-anchor" href="#inventory" aria-label="Permalink to &quot;inventory&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">192.168.95.114   ansible_user=host</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">192.168.95.115   ansible_user=host</span></span></code></pre></div><h3 id="playbook" tabindex="-1">playbook <a class="header-anchor" href="#playbook" aria-label="Permalink to &quot;playbook&quot;">​</a></h3><p><code>nginx-install.yml</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">hosts</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">test</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  become</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">yes</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  become_user</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">root</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  become_method</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">su</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  roles</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  - {</span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">role</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">nginx</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">     nginx_http_params</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;sendfile on&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;access_log /var/log/nginx/access.log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span></code></pre></div><h3 id="command" tabindex="-1">command <a class="header-anchor" href="#command" aria-label="Permalink to &quot;command&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ansible-playbook</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> hosts</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> nginx-install.yml</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --become</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -K</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -vvv</span></span></code></pre></div><h3 id="说明" tabindex="-1">说明 <a class="header-anchor" href="#说明" aria-label="Permalink to &quot;说明&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>--ask-become-pass, -K</span></span>
<span class="line"><span> 	ask for privilege escalation password, does not imply become will be used</span></span>
<span class="line"><span>--become, -b	run operations with become (no password implied)</span></span>
<span class="line"><span>--become-method=BECOME_METHOD</span></span>
<span class="line"><span> 	privilege escalation method to use (default=sudo), valid choices: [ sudo | su | pbrun | pfexec | doas | dzdo | ksu ]</span></span>
<span class="line"><span>--become-user=BECOME_USER</span></span>
<span class="line"><span> 	run operations as this user (default=root), does not imply –become/-b</span></span></code></pre></div><h2 id="错误" tabindex="-1">错误 <a class="header-anchor" href="#错误" aria-label="Permalink to &quot;错误&quot;">​</a></h2><blockquote><p>&quot;Timeout (12s) waiting for privilege escalation prompt:</p></blockquote><p>参考 <a href="https://stackoverflow.com/questions/21870083/specify-sudo-password-for-ansible" target="_blank" rel="noreferrer">Specify sudo password for Ansible</a></p><h3 id="命令行方式" tabindex="-1">命令行方式 <a class="header-anchor" href="#命令行方式" aria-label="Permalink to &quot;命令行方式&quot;">​</a></h3><p>当:</p><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  become_method</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">sudo</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ansible-playbook</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> playbook.yml</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> inventory.ini</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --user=username</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --extra-vars</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;ansible_sudo_pass=yourPassword&quot;</span></span></code></pre></div><p>当:</p><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  become_method</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">su</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ansible-playbook</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> playbook.yml</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> inventory.ini</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --user=username</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --extra-vars</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;ansible_su_pass=yourPassword&quot;</span></span></code></pre></div><h3 id="配置方式" tabindex="-1">配置方式 <a class="header-anchor" href="#配置方式" aria-label="Permalink to &quot;配置方式&quot;">​</a></h3><p>Inventory file:</p><div class="language-ini vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">[test]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">192.168.95.152  </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">ansible_user</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=host </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">ansible_ssh_pass</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=host </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">ansible_su_pass</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">=host</span></span></code></pre></div><hr><div style="text-align:center;color:#00000099;font-size:14px;">END</div>`,28)]))}const g=a(t,[["render",l]]);export{c as __pageData,g as default};
