import{_ as s,a as i,o as a,aj as e}from"./chunks/framework.Ba_Ek9Jm.js";const u=JSON.parse('{"title":"在 Ubuntu Linux 上创建 Swap 空间","description":"","frontmatter":{"title":"在 Ubuntu Linux 上创建 Swap 空间","date":"2023-08-08T00:00:00.000Z","tags":["linux"],"category":["DevOps"]},"headers":[],"relativePath":"posts/2023/08/2023-08-08-ubuntu-linux-add-swap-space.md","filePath":"posts/2023/08/2023-08-08-ubuntu-linux-add-swap-space.md","lastUpdated":1718173059000}'),p={name:"posts/2023/08/2023-08-08-ubuntu-linux-add-swap-space.md"},t=e(`<p>swap 是物理RAM内存已满时使用的磁盘空间：当Linux系统用完RAM时，非活动页面将从RAM移动到交换空间。</p><h2 id="创建交换空间文件" tabindex="-1">创建交换空间文件 <a class="header-anchor" href="#创建交换空间文件" aria-label="Permalink to &quot;创建交换空间文件&quot;">​</a></h2><h3 id="使用dd命令创建swap交换空间文件" tabindex="-1">使用dd命令创建swap交换空间文件 <a class="header-anchor" href="#使用dd命令创建swap交换空间文件" aria-label="Permalink to &quot;使用dd命令创建swap交换空间文件&quot;">​</a></h3><p>以下<code>fallocate</code>和<code>dd</code>命令将会在你 Ubuntu 20.04 的根目录中创建交换空间文件<code>/swapfile</code>，大小是<code>2G</code>。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> fallocate</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 2G</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /swapfile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> if=/dev/zero</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of=/swapfile</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bs=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1024</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> count=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2097152</span></span></code></pre></div><p>当然也可以指定单位，<code>bs=1M count=2048</code> 同样是 2G 的大小：</p><div class="language-Shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> if=/dev/zero</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> of=/swapfile</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> bs=1M</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> count=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">2048</span></span></code></pre></div><p>默认交换空间文件的权限只有<code>root</code>用户才能写入和读取交换文件的数据。因此我们需要修改交换空间文件的权限为<code>600</code>。</p><p>在Linux中可使用<code>chmod</code>修改文件权限，除此之外你还需要格式化交换空间的文件。</p><p>交换空间文件所使用的文件系统与普通文件系统不一样， 交换空间它有自己的文件系统格式和专用个格式化工具<code>mkswap</code>。</p><p>以下命令将修改交换空间文件的权限为600，并使用<code>mkswap</code>格式化文件。</p><div class="language-Shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 600</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /swapfile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mkswap</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /swapfile</span></span></code></pre></div><h2 id="启用交换空间" tabindex="-1">启用交换空间 <a class="header-anchor" href="#启用交换空间" aria-label="Permalink to &quot;启用交换空间&quot;">​</a></h2><p>当你格式化完成后，为了让系统识别交换空间文件，因此还需要手动启用交换空间文件。</p><p>在 Ubuntu 中你可以使用<code>swapon</code>命令启用交换空间文件， 它将会在自动挂载到系统中。运行命令<code>sudo swapon /swapfile</code>。</p><div class="language-Shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> swapon</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /swapfile</span></span></code></pre></div><p><code>swapon</code>命令启用交换空间仅当前会话可用，重启后将不会自动挂载。 为了让交换空间永久启用，并在开机启动时自动挂载。</p><p>要在Linux系统启动时自动挂载分区，你需要在<code>/etc/fstab</code>文件中定义挂载配置选项。</p><p><code>/etc/fstab</code>文件存储着文件系统的静态挂载信息， 可用于定义磁盘分区，各种其他块设备或远程文件系统， 告知Linux内核如何在挂载这些设备文件。</p><p>以下命令使用<code>echo</code>，<code>tee</code>命令以及管道追加行<code>/swapfile swap swap defaults 0 0</code> 到<code>/etc/fstab</code>文件。</p><p>当计算机在重启时，交换空间将会自动启用。 可以运行命令<code>swapon</code>或<code>free</code>命令验证交换空间是否处于活动状态。</p><div class="language-Shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;/swapfile swap swap defaults 0 0&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/fstab</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> swapon</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --show</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> free</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -h</span></span></code></pre></div><h2 id="swappiness" tabindex="-1">Swappiness <a class="header-anchor" href="#swappiness" aria-label="Permalink to &quot;Swappiness&quot;">​</a></h2><p><code>Swappiness</code>是一个Linux内核属性，用于定义系统使用交换空间的频率。 <code>Swappiness</code>可以是<code>0</code>到<code>100</code>之间的值。</p><p><code>swappiness=0</code>的时候表示最大限度使用物理内存，然后才是交换空间， <code>swappiness＝100</code>的时候表示积极的使用交换空间。</p><p>Linux的初始默认设置为<code>60</code>， 你可以运行命令<code>cat /proc/sys/vm/swappiness</code>命令查看当前<code>swappiness</code>值的大小。</p><div class="language-Shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /proc/sys/vm/swappiness</span></span></code></pre></div><p>如果你需要对<code>swappiness</code>的值作出更改， 请运行<code>sudo sysctl -w vm.swappiness=10</code>命令。</p><div class="language-Shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sysctl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> vm.swappiness=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">10</span></span></code></pre></div><p><code>sysctl</code>命令用于在运行时配置Linux内核的参数，更改仅在当前会话中可用，即重启会恢复为默认值。</p><p>为让<code>swappiness</code>的值持久化， 则需要将值写入到<code>/etc/sysctl.conf</code>文件中。 <code>sysctl.conf</code>是Linux内核的配置文件。在Linux内核启动是将会次配置文件的参数。</p><p>运行以下命令持久化Linux内核参数<code>swappiness</code>的值。</p><div class="language-Shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;/swapfile swap swap defaults 0 0&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tee</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/sysctl.conf</span></span></code></pre></div><h2 id="删除交换空间" tabindex="-1">删除交换空间 <a class="header-anchor" href="#删除交换空间" aria-label="Permalink to &quot;删除交换空间&quot;">​</a></h2><p>如果你因某些原因需要关闭并且删除交换文件。你必须首先运行命令<code>swapoff</code>关闭交换空间。</p><p>如果你的交换空间文件还启用<code>fstab</code>方式的自动挂载， 你还需要删除<code>/etc/fstab</code>文件中定义的自动挂载配置。</p><p>使用你喜欢的编辑器打开文件<code>/etc/fstab</code>，并移除行定义交换空间自动挂载的行。</p><div class="language-Shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">Shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> swapoff</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /swapfile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /etc/fstab</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 移出对应行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> rm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /swapfile</span></span></code></pre></div><hr><ul><li><a href="https://www.sysgeek.cn/ubuntu-swap-size/" target="_blank" rel="noreferrer">https://www.sysgeek.cn/ubuntu-swap-size/</a></li><li><a href="https://www.myfreax.com/how-to-add-swap-space-on-ubuntu-20-04/" target="_blank" rel="noreferrer">https://www.myfreax.com/how-to-add-swap-space-on-ubuntu-20-04/</a></li></ul>`,40),n=[t];function l(h,d,o,k,c,F){return a(),i("div",null,n)}const g=s(p,[["render",l]]);export{u as __pageData,g as default};
