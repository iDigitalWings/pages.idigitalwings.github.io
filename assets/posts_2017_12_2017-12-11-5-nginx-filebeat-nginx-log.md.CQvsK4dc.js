import{_ as i,a,af as n,o as t}from"./chunks/framework.C87LdZyP.js";const d=JSON.parse('{"title":"Filebeat: Nginx log","description":"","frontmatter":{"title":"Filebeat: Nginx log","date":"2017-12-11T00:00:00.000Z","tags":["logstash","nginx","filebeat"]},"headers":[],"relativePath":"posts/2017/12/2017-12-11-5-nginx-filebeat-nginx-log.md","filePath":"posts/2017/12/2017-12-11-5-nginx-filebeat-nginx-log.md","lastUpdated":1718173059000}'),e={name:"posts/2017/12/2017-12-11-5-nginx-filebeat-nginx-log.md"};function l(p,s,h,k,o,r){return t(),a("div",null,s[0]||(s[0]=[n(`<p>2017-12-12 15:16:58.105 [http-nio-30010-exec-368] ERROR o.springframework.boot.web.support.ErrorPageFilter - Cannot forward to error page for request [/wms/rf/invQuery/getLocInventorys] as the response has already been committed. As a result, the response may have the wrong status code. If your application is running on WebSphere Application Server you may be able to resolve this problem by setting com.ibm.ws.webcontainer.invokeFlushAfterService to false org.apache.catalina.connector.ClientAbortException: java.io.IOException: Broken pipe at org.apache.catalina.connector.OutputBuffer.realWriteBytes(OutputBuffer.java:393)</p><p>sshpass -p TongtianxiaoAdmin803 ssh 121.199.167.84 -o StrictHostKeyChecking=no -l root -o ProxyCommand=&#39;sshpass -p TongtianxiaoAdmin803 ssh 101.37.88.54 -o StrictHostKeyChecking=no -l root -W %h:%p&#39;&quot;</p><h2 id="为nginx增加json日志" tabindex="-1">为Nginx增加Json日志 <a class="header-anchor" href="#为nginx增加json日志" aria-label="Permalink to &quot;为Nginx增加Json日志&quot;">​</a></h2><div class="language-perl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">perl</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">log_format json </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;{&quot;@timestamp&quot;:&quot;$time_iso8601&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;host&quot;:&quot;$server_addr&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;clientip&quot;:&quot;$remote_addr&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;remote_user&quot;:&quot;$remote_user&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;request&quot;:&quot;$request&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;size&quot;:$body_bytes_sent,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;responsetime&quot;:$request_time,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;uct&quot;:$upstream_connect_time,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;uht&quot;:$upstream_header_time ,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;upstreamtime&quot;:&quot;$upstream_response_time&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;upstreamhost&quot;:&quot;$upstream_addr&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;http_host&quot;:&quot;$host&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;url&quot;:&quot;$uri&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;domain&quot;:&quot;$host&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;xff&quot;:&quot;$http_x_forwarded_for&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;referer&quot;:&quot;$http_referer&quot;,&#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                  &#39;&quot;status&quot;:&quot;$status&quot;}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">access_log logs/access.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> json;</span></span></code></pre></div><h2 id="filebeat-配置" tabindex="-1">Filebeat 配置 <a class="header-anchor" href="#filebeat-配置" aria-label="Permalink to &quot;Filebeat 配置&quot;">​</a></h2><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># vim /etc/filebeat/filebeat.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">filebeat.prospectors</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">input_type</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">log</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    paths</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/usr/local/nginx/logs/zixun.oupeng.com.access.log</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">    document_type</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">zixun-nginx-access</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">- </span><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">input_type</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">log</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  paths</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    - </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">/usr/local/nginx/logs/water.oupeng.com.access.log</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  document_type</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">water-nginx-access</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">output.logstash</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  hosts</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;192.168.3.56:5044&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;192.168.3.49:5044&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;192.168.3.57:5044&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#8DDB8C;">  loadbalance</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span></span></code></pre></div><h2 id="测试配置" tabindex="-1">测试配置 <a class="header-anchor" href="#测试配置" aria-label="Permalink to &quot;测试配置&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">filebeat.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --help</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">filebeat.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -configtest</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -e</span></span></code></pre></div><h2 id="logstash-pipline" tabindex="-1">Logstash pipline <a class="header-anchor" href="#logstash-pipline" aria-label="Permalink to &quot;Logstash pipline&quot;">​</a></h2><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># vim /etc/logstash/conf.d/nginx.conf</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">input {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  beats {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    port =&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">5044</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    codec =&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;json&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">output {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [type] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;zixun-nginx-access&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    elasticsearch {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        hosts =&gt; [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;192.168.3.56:9200&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;192.168.3.49:9200&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;192.168.3.57:9200&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        index =&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;zixun-nginx-access-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        document_type =&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;%{[@metadata][type]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        template_overwrite =&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        user =&gt; elastic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        password =&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">Monkey</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [type] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">==</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;water-nginx-access&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    elasticsearch {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        hosts =&gt; [</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;192.168.3.56:9200&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;192.168.3.49:9200&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;192.168.3.57:9200&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        index =&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;water-nginx-access-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        document_type =&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;%{[@metadata][type]}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        template_overwrite =&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        user =&gt; elastic</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        password =&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">Monkey</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }}   </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><hr><ul><li><a href="https://www.cnblogs.com/keithtt/p/7143970.html" target="_blank" rel="noreferrer">debian安装filebeat5.5收集nginx日志</a></li><li><a href="https://www.nginx.com/resources/admin-guide/logging-and-monitoring/" target="_blank" rel="noreferrer">Nginx: Setting Up the Access Log</a></li></ul>`,12)]))}const c=i(e,[["render",l]]);export{d as __pageData,c as default};
