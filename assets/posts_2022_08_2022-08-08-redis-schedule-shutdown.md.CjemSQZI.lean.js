import{_ as i,a,af as h,o as k}from"./chunks/framework.C87LdZyP.js";const g=JSON.parse('{"title":"Redis周期性重启","description":"","frontmatter":{"title":"Redis周期性重启","date":"2022-08-07T00:00:00.000Z","tags":["gitops"],"category":["其它"]},"headers":[],"relativePath":"posts/2022/08/2022-08-08-redis-schedule-shutdown.md","filePath":"posts/2022/08/2022-08-08-redis-schedule-shutdown.md","lastUpdated":1718173059000}'),n={name:"posts/2022/08/2022-08-08-redis-schedule-shutdown.md"};function t(l,s,p,F,e,d){return k(),a("div",null,s[0]||(s[0]=[h(`<p>Redis 周期性的重启，日志如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:C</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.245</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:C</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.245</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # Redis version=7.0.3, bits=64, commit=00000000, modified=0, pid=1, just started</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:C</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.245</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # Configuration loaded</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.597</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> monotonic</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> clock:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> POSIX</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> clock_gettime</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.606</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Running</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mode=standalone,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> port=6379.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.654</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.654</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # Server initialized</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.655</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Reading</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> RDB</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> base</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AOF</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> loading...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.655</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Loading</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> RDB</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> produced</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> version</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 7.0.3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.655</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> RDB</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> age</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 182579</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.655</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> RDB</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> memory</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> usage</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> when</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> created</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1.71</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Mb</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.655</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> RDB</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> base</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AOF</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:15.813</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Done</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> loading</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> RDB,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> keys</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> loaded:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 518,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> keys</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> expired:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 0.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:16.241</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DB</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> loaded</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> base</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> appendonly.aof.4.base.rdb:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 0.587</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:20.537</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DB</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> loaded</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> incr</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> appendonly.aof.4.incr.aof:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 4.296</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:20.537</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> DB</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> loaded</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> append</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> only</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> file:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 4.883</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> seconds</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:20.537</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Opening</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AOF</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> incr</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> appendonly.aof.4.incr.aof</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> start</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:38:20.538</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> accept</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> connections</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:signal-handler</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (1663836180) Received SIGTERM scheduling shutdown...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:43:00.471</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # User requested shutdown...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:43:00.471</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Calling</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> fsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">() </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">on</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> AOF</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> file.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">1:M</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Sep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2022</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 03:43:00.820</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # Redis is now ready to exit, bye bye...</span></span></code></pre></div><p>根据日志看到关闭原因： <code>Received SIGTERM scheduling shutdown</code>。</p><p>应该是客户端发送了关闭指令，暂时找不到应用程序发送关闭指令的时候，先重写了shutdown 指令。</p><p><code>master.conf</code> 和 <code>replica.conf</code> 两个文件配置里面添加了：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">rename-command</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> SHUTDOWN</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&quot;</span></span></code></pre></div><hr><ul><li><a href="https://cloud.tencent.com/developer/article/1422207" target="_blank" rel="noreferrer">https://cloud.tencent.com/developer/article/1422207</a></li><li><a href="https://stackoverflow.com/questions/42079847/determining-why-redis-is-receiving-a-sigterm-every-minute-or-two" target="_blank" rel="noreferrer">https://stackoverflow.com/questions/42079847/determining-why-redis-is-receiving-a-sigterm-every-minute-or-two</a></li></ul>`,8)]))}const y=i(n,[["render",t]]);export{g as __pageData,y as default};
