import{_ as i,a,af as n,o as t}from"./chunks/framework.C87LdZyP.js";const F=JSON.parse('{"title":"Mac m1 wenda 等 orjson 安装问题","description":"","frontmatter":{"title":"Mac m1 wenda 等 orjson 安装问题","date":"2023-03-03T00:00:00.000Z","tags":["ai","ml"],"category":["AI"]},"headers":[],"relativePath":"posts/2023/03/2023-03-03-mac-m1-orjson.md","filePath":"posts/2023/03/2023-03-03-mac-m1-orjson.md","lastUpdated":1718173059000}'),e={name:"posts/2023/03/2023-03-03-mac-m1-orjson.md"};function l(p,s,h,k,r,o){return t(),a("div",null,s[0]||(s[0]=[n(`<h2 id="importerror-using-socks-proxy-but-the-socksio-package-is-not-installed" tabindex="-1">ImportError: Using SOCKS proxy, but the &#39;socksio&#39; package is not installed. <a class="header-anchor" href="#importerror-using-socks-proxy-but-the-socksio-package-is-not-installed" aria-label="Permalink to &quot;ImportError: Using SOCKS proxy, but the &#39;socksio&#39; package is not installed.&quot;">​</a></h2><blockquote><p>ImportError: Using SOCKS proxy, but the &#39;socksio&#39; package is not installed. Make sure to install httpx using <code>pip install httpx[socks]</code>.</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> httpx-socks</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> socksio</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pysocks</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> https_proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">http://127.0.0.1:7890 http_proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">http://127.0.0.1:7890 all_proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">socks5://127.0.0.1:7890</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">unset</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> all_proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">unset</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ALL_PROXY</span></span></code></pre></div><h2 id="orjson-cpython-310-darwin-so-mach-o-file-but-is-an-incompatible-architecture-have-arm64-need-x86-64" tabindex="-1">orjson.cpython-310-darwin.so&#39; (mach-o file, but is an incompatible architecture (have &#39;arm64&#39;, need &#39;x86_64&#39;)) <a class="header-anchor" href="#orjson-cpython-310-darwin-so-mach-o-file-but-is-an-incompatible-architecture-have-arm64-need-x86-64" aria-label="Permalink to &quot;orjson.cpython-310-darwin.so&#39; (mach-o file, but is an incompatible architecture (have &#39;arm64&#39;, need &#39;x86_64&#39;))&quot;">​</a></h2><blockquote><p>ImportError: dlopen(/Users/alan/opt/anaconda3/envs/langchain-ChatGLM/lib/python3.10/site-packages/orjson/orjson.cpython-310-darwin.so, 0x0002): tried: &#39;/Users/alan/opt/anaconda3/envs/langchain-ChatGLM/lib/python3.10/site-packages/orjson/orjson.cpython-310-darwin.so&#39; (mach-o file, but is an incompatible architecture (have &#39;arm64&#39;, need &#39;x86_64&#39;)), &#39;/System/Volumes/Preboot/Cryptexes/OS/Users/alan/opt/anaconda3/envs/langchain-ChatGLM/lib/python3.10/site-packages/orjson/orjson.cpython-310-darwin.so&#39; (no such file), &#39;/Users/alan/opt/anaconda3/envs/langchain-ChatGLM/lib/python3.10/site-packages/orjson/orjson.cpython-310-darwin.so&#39; (mach-o file, but is an incompatible architecture (have &#39;arm64&#39;, need &#39;x86_64&#39;))</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> orjson==</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">3.8.1</span></span></code></pre></div><h2 id="no-sentence-transformers-model-found-with-name" tabindex="-1">No sentence-transformers model found with name <a class="header-anchor" href="#no-sentence-transformers-model-found-with-name" aria-label="Permalink to &quot;No sentence-transformers model found with name&quot;">​</a></h2><blockquote><p>No sentence-transformers model found with name /Users/alan/.cache/torch/sentence_transformers/GanymedeNil_text2vec-large-chinese. Creating a new one with MEAN pooling.</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> text2vec</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> clone</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://huggingface.co/GanymedeNil/text2vec-large-chinese</span></span></code></pre></div><h2 id="clang-error-unsupported-option-fopenmp" tabindex="-1">clang: error: unsupported option &#39;-fopenmp&#39; <a class="header-anchor" href="#clang-error-unsupported-option-fopenmp" aria-label="Permalink to &quot;clang: error: unsupported option &#39;-fopenmp&#39;&quot;">​</a></h2><blockquote><p>clang: error: unsupported option &#39;-fopenmp&#39;</p></blockquote><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><a href="https://github.com/jts/nanopolish/issues/789" target="_blank" rel="noreferrer">https://github.com/jts/nanopolish/issues/789</a></p><p>See #279. This is usually a problem on the Mac, because the compiler that comes with it doesn&#39;t have OpenMP enabled. You can use <a href="https://brew.sh" target="_blank" rel="noreferrer">https://brew.sh</a> (Homebrew) to install gcc.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> gcc</span></span></code></pre></div><p>Then you can find all the versions of GCC you&#39;ve installed</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> list</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> gcc</span></span></code></pre></div><p>At the time of this comment this should be gcc-9. So you need to compile with</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> CXX=g++-9</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> CC=gcc-9</span></span></code></pre></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>On apple&#39;s <code>llvm</code>, <code>-fopenmp</code> is not supported. One should use brew&#39;s <code>llvm</code>.</p><p>The following commands will allow linking openmp:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> llvm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> libomp</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> CC</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">/usr/local/opt/llvm/bin/clang</span></span></code></pre></div><p>For reference, the issue where there are all the commands: <a href="https://github.com/bluesheeptoken/CPT/issues/68#issuecomment-563342866" target="_blank" rel="noreferrer">https://github.com/bluesheeptoken/CPT/issues/68#issuecomment-563342866</a></p></div><h2 id="发生错误-正在重新加载模型-layernormkernelimpl-not-implemented-for-half" tabindex="-1">发生错误，正在重新加载模型&quot;LayerNormKernelImpl&quot; not implemented for &#39;Half&#39; <a class="header-anchor" href="#发生错误-正在重新加载模型-layernormkernelimpl-not-implemented-for-half" aria-label="Permalink to &quot;发生错误，正在重新加载模型&quot;LayerNormKernelImpl&quot; not implemented for &#39;Half&#39;&quot;">​</a></h2><blockquote><p>发生错误，正在重新加载模型&quot;LayerNormKernelImpl&quot; not implemented for &#39;Half&#39;</p></blockquote><p>--skip-torch-cuda-test --no-half --use-cpu all</p><p><a href="https://github.com/facebookresearch/fairseq/issues/2413" target="_blank" rel="noreferrer">https://github.com/facebookresearch/fairseq/issues/2413</a></p><h2 id="mixed-dtype-cpu-expect-input-to-have-scalar-type-of-bfloat16" tabindex="-1">mixed dtype (CPU): expect input to have scalar type of BFloat16 <a class="header-anchor" href="#mixed-dtype-cpu-expect-input-to-have-scalar-type-of-bfloat16" aria-label="Permalink to &quot;mixed dtype (CPU): expect input to have scalar type of BFloat16&quot;">​</a></h2><h2 id="requests-exceptions-invalidschema-missing-dependencies-for-socks-support" tabindex="-1">requests.exceptions.InvalidSchema: Missing dependencies for SOCKS support. <a class="header-anchor" href="#requests-exceptions-invalidschema-missing-dependencies-for-socks-support" aria-label="Permalink to &quot;requests.exceptions.InvalidSchema: Missing dependencies for SOCKS support.&quot;">​</a></h2><blockquote><p>requests.exceptions.InvalidSchema: Missing dependencies for SOCKS support.</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">unset</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> all_proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">unset</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ALL_PROXY</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pysocks</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> all_proxy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;https://&lt;proxy&gt;:&lt;port&gt;/&quot;</span></span></code></pre></div><h2 id="" tabindex="-1"><a class="header-anchor" href="#" aria-label="Permalink to &quot;&quot;">​</a></h2><h3 id="错误" tabindex="-1">错误 <a class="header-anchor" href="#错误" aria-label="Permalink to &quot;错误&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  File</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;/Users/me/.cache/huggingface/modules/transformers_modules/chatglm-6b-int4/modeling_chatglm.py&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> line</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 1061,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> __init__</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    self.quantize(self.config.quantization_bit,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> self.config.quantization_embeddings,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> use_quantization_cache=True,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> empty_init=True</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  File</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;/Users/alan/.cache/huggingface/modules/transformers_modules/chatglm-6b-int4/modeling_chatglm.py&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> line</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 1424,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> quantize</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> .quantization</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> quantize,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> QuantizedEmbedding,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> QuantizedLinear,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> load_cpu_kernel</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  File</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&lt;frozen importlib._bootstrap&gt;&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> line</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 1027,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> _find_and_load</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  File</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&lt;frozen importlib._bootstrap&gt;&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> line</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 1006,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> _find_and_load_unlocked</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  File</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&lt;frozen importlib._bootstrap&gt;&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> line</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 688,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> _load_unlocked</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  File</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&lt;frozen importlib._bootstrap_external&gt;&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> line</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 883,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exec_module</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  File</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;&lt;frozen importlib._bootstrap&gt;&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> line</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 241,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> _call_with_frames_removed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  File</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;/Users/alan/.cache/huggingface/modules/transformers_modules/chatglm-6b-int4/quantization.py&quot;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> line</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 45,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">modul</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    logger.warning(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&quot;Failed to load cpm_kernels:&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exception</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Message:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;Failed to load cpm_kernels:&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Arguments:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (RuntimeError(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;Unknown platform: darwin&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">),)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">No</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> compiled</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kernel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> found.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Compiling</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kernels</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /Users/alan/.cache/huggingface/modules/transformers_modules/chatglm-6b-int4/quantization_kernels_parallel.c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Compiling</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> gcc</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -O3</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -fPIC</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -pthread</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -fopenmp</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -std=c99</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /Users/alan/.cache/huggingface/modules/transformers_modules/chatglm-6b-int4/quantization_kernels_parallel.c</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -shared</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /Users/alan/.cache/huggingface/modules/transformers_modules/chatglm-6b-int4/quantization_kernels_parallel.so</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">clang:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> error:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> unsupported</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> option</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;-fopenmp&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">clang:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> error:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> unsupported</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> option</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;-fopenmp&#39;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Compile</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cpu</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kernel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> failed,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> using</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cpu</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kernel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> code.</span></span></code></pre></div><h3 id="解决方法-重新编译" tabindex="-1">解决方法：重新编译 <a class="header-anchor" href="#解决方法-重新编译" aria-label="Permalink to &quot;解决方法：重新编译&quot;">​</a></h3><p><a href="https://github.com/THUDM/ChatGLM-6B/issues/6#issuecomment-1471303336" target="_blank" rel="noreferrer">https://github.com/THUDM/ChatGLM-6B/issues/6#issuecomment-1471303336</a></p><div class="language-gitdiff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">gitdiff</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>--- a/modeling_chatglm.py</span></span>
<span class="line"><span>+++ b/modeling_chatglm.py</span></span>
<span class="line"><span>@@ -1166,6 +1166,6 @@ class ChatGLMForConditionalGeneration(ChatGLMPreTrainedModel):</span></span>
<span class="line"><span>         return torch.tensor(return_seqs, dtype=torch.long, device=kwargs[&#39;input_ids&#39;].device)</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>     def quantize(self, bits: int):</span></span>
<span class="line"><span>-        from .quantization import quantize</span></span>
<span class="line"><span>-        self.transformer = quantize(self.transformer, bits)</span></span>
<span class="line"><span>+        # from .quantization import quantize</span></span>
<span class="line"><span>+        # self.transformer = quantize(self.transformer, bits)</span></span></code></pre></div><div class="language-gitdiff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">gitdiff</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>--- a/web_demo.py</span></span>
<span class="line"><span>+++ b/web_demo.py</span></span>
<span class="line"><span>@@ -1,8 +1,8 @@</span></span>
<span class="line"><span> from transformers import AutoModel, AutoTokenizer</span></span>
<span class="line"><span> import gradio as gr</span></span>
<span class="line"><span> </span></span>
<span class="line"><span>-tokenizer = AutoTokenizer.from_pretrained(&quot;THUDM/chatglm-6b&quot;, trust_remote_code=True)</span></span>
<span class="line"><span>-model = AutoModel.from_pretrained(&quot;THUDM/chatglm-6b&quot;, trust_remote_code=True).half().cuda()</span></span>
<span class="line"><span>+tokenizer = AutoTokenizer.from_pretrained(&quot;../chatglm&quot;, trust_remote_code=True)</span></span>
<span class="line"><span>+model = AutoModel.from_pretrained(&quot;../chatglm&quot;, trust_remote_code=True).float()</span></span>
<span class="line"><span> model = model.eval()</span></span></code></pre></div><h2 id="nonetype-object-has-no-attribute-message-types-by-name" tabindex="-1">&#39;NoneType&#39; object has no attribute &#39;message_types_by_name&#39; <a class="header-anchor" href="#nonetype-object-has-no-attribute-message-types-by-name" aria-label="Permalink to &quot;&#39;NoneType&#39; object has no attribute &#39;message_types_by_name&#39;&quot;">​</a></h2><blockquote><p>&#39;NoneType&#39; object has no attribute &#39;message_types_by_name&#39;</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> protobuf</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --upgrade</span></span></code></pre></div><h2 id="ascii-codec-can-t-decode-byte-0xe4-in-position-0-ordinal-not-in-range-128" tabindex="-1">&#39;ascii&#39; codec can&#39;t decode byte 0xe4 in position 0: ordinal not in range(128) <a class="header-anchor" href="#ascii-codec-can-t-decode-byte-0xe4-in-position-0-ordinal-not-in-range-128" aria-label="Permalink to &quot;&#39;ascii&#39; codec can&#39;t decode byte 0xe4 in position 0: ordinal not in range(128)&quot;">​</a></h2><blockquote><p>&#39;ascii&#39; codec can&#39;t decode byte 0xe4 in position 0: ordinal not in range(128)</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># python3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> PYTHONIOENCODING</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">utf8</span></span></code></pre></div><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># -*- coding: utf-8 -*-</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> ...</span></span></code></pre></div><h2 id="detectron2-is-not-installed-and-the-text-of-the-pdf-is-not-extractable" tabindex="-1">detectron2 is not installed and the text of the PDF is not extractable. <a class="header-anchor" href="#detectron2-is-not-installed-and-the-text-of-the-pdf-is-not-extractable" aria-label="Permalink to &quot;detectron2 is not installed and the text of the PDF is not extractable.&quot;">​</a></h2><blockquote><p>detectron2 is not installed and the text of the PDF is not extractable. To process this file, install detectron2 or remove copy protection from the PDF. /content/langchain-ChatGLM/content/十万个为什么.PDF 未能成功加载</p></blockquote><p><a href="https://detectron2.readthedocs.io/en/latest/tutorials/install.html" target="_blank" rel="noreferrer">https://detectron2.readthedocs.io/en/latest/tutorials/install.html</a></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">python</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;git+https://github.com/facebookresearch/detectron2.git&#39;</span></span></code></pre></div><h2 id="unable-to-get-page-count-is-poppler-installed-and-in-path" tabindex="-1">Unable to get page count. Is poppler installed and in PATH? <a class="header-anchor" href="#unable-to-get-page-count-is-poppler-installed-and-in-path" aria-label="Permalink to &quot;Unable to get page count. Is poppler installed and in PATH?&quot;">​</a></h2><blockquote><p>Unable to get page count. Is poppler installed and in PATH? /content/langchain-ChatGLM/content/十万个为什么.PDF 未能成功加载</p></blockquote><p><a href="https://cbrunet.net/python-poppler/installation.html#installing-from-pypi" target="_blank" rel="noreferrer">https://cbrunet.net/python-poppler/installation.html#installing-from-pypi</a></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --use-pep517</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> python-poppler</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">error</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Looking</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> indexes:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://pypi.org/simple,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://us-python.pkg.dev/colab-wheels/public/simple/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Collecting</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> python-poppler</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  Using</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cached</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> python_poppler-0.4.1.tar.gz</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (138 </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">kB</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  Installing</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dependencies</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ...</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> done</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  Getting</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> requirements</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> wheel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ...</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> done</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  Installing</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> backend</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> dependencies</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ...</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> done</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  error:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> subprocess-exited-with-error</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  ×</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Preparing</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (pyproject.toml) did not run successfully.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  │</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> exit</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> code:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  ╰─</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">See</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> above</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> output.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  note:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> This</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> error</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> originates</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> subprocess,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> likely</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> problem</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pip.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  Preparing</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (pyproject.toml) ... error</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">error:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> metadata-generation-failed</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">×</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Encountered</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> error</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> while</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> generating</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> package</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> metadata.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">╰─</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">See</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> above</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> output.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">note:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> This</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> an</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> issue</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> package</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mentioned</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> above,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pip.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">hint:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> See</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> above</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> details.</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pip==</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">21.3.1</span></span></code></pre></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Failed</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> python-poppler</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ERROR:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Could</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> build</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> wheels</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> python-poppler,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> which</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> required</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pyproject.toml-based</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> projects</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">apt-get</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> poppler-utils</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> libpoppler-cpp-dev</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -v</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -v</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> python-poppler</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pdf2image</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#!pip install --upgrade pip</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pip==</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">21.3.1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --upgrade</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> setuptools</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> wheel</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --use-pep517</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> python-poppler</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#!pip install --use-pep517 --no-binary python-poppler python-poppler==0.4.1</span></span></code></pre></div></div><h2 id="torch-cuda-outofmemoryerror-cuda-out-of-memory" tabindex="-1">torch.cuda.OutOfMemoryError: CUDA out of memory. <a class="header-anchor" href="#torch-cuda-outofmemoryerror-cuda-out-of-memory" aria-label="Permalink to &quot;torch.cuda.OutOfMemoryError: CUDA out of memory.&quot;">​</a></h2><blockquote><p>torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 42.37 GiB (GPU 0; 14.75 GiB total capacity; 10.65 GiB already allocated; 1.66 GiB free; 11.92 GiB reserved in total by PyTorch) If reserved memory is &gt;&gt; allocated memory try setting max_split_size_mb to avoid fragmentation. See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">PYTORCH_CUDA_ALLOC_CONF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">max_split_size_mb:32MB</span></span></code></pre></div><h2 id="only-tensors-of-floating-point-and-complex-dtype-can-require-gradients" tabindex="-1">Only Tensors of floating point and complex dtype can require gradients <a class="header-anchor" href="#only-tensors-of-floating-point-and-complex-dtype-can-require-gradients" aria-label="Permalink to &quot;Only Tensors of floating point and complex dtype can require gradients&quot;">​</a></h2><h3 id="chatglm-6b-int4" tabindex="-1">ChatGLM 6B int4 <a class="header-anchor" href="#chatglm-6b-int4" aria-label="Permalink to &quot;ChatGLM 6B int4&quot;">​</a></h3><blockquote><p>Only Tensors of floating point and complex dtype can require gradients</p><p>你加载的是int4量化的模型吗？ 应该是 accelerate 库的问题。量化后的权重是以int8的格式保存的，对于int8的权重 pytorch 不能设置 requires_grad=True（默认值）。我们的代码里已经设置了 requires_grad=False，但是 accelerate 并没有正确地传进去。因为我没法改库里的代码所以暂时没法解决。</p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># low_cpu_mem_usage=True,</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>!export PYTHONIOENCODING=utf8</span></span>
<span class="line"><span>!export PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:64MB</span></span>
<span class="line"><span>!python web_demo.py</span></span></code></pre></div><ul><li><a href="https://github.com/THUDM/ChatGLM-6B/issues/470" target="_blank" rel="noreferrer">https://github.com/THUDM/ChatGLM-6B/issues/470</a></li></ul><h2 id="importerror-this-modeling-file-requires-the-following-packages-that-were-not-found-in-your-environment-sat-run-pip-install-sat" tabindex="-1">ImportError: This modeling file requires the following packages that were not found in your environment: sat. Run <code>pip install sat</code> <a class="header-anchor" href="#importerror-this-modeling-file-requires-the-following-packages-that-were-not-found-in-your-environment-sat-run-pip-install-sat" aria-label="Permalink to &quot;ImportError: This modeling file requires the following packages that were not found in your environment: sat. Run \`pip install sat\`&quot;">​</a></h2><blockquote><p>ImportError: This modeling file requires the following packages that were not found in your environment: sat. Run <code>pip install sat</code></p></blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -U</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> python-sat</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> SwissArmyTransforme</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">r</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0.3.6</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> torc</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">h</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">1.10.0</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> torchvision</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> transformer</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">s</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">4.27.1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mdtex2html</span></span></code></pre></div><blockquote><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"></span></code></pre></div></blockquote><p>OutOfMemoryError: CUDA out of memory. Tried to allocate 34.00 MiB (GPU 0; 14.75 GiB total capacity; 14.07 GiB already allocated; 28.81 MiB free; 14.13 GiB reserved in total by PyTorch) If reserved memory is &gt;&gt; allocated memory try setting max_split_size_mb to avoid fragmentation. See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span></span></span></code></pre></div>`,60)]))}const c=i(e,[["render",l]]);export{F as __pageData,c as default};
