import{_ as s,a as i,o as a,aj as n}from"./chunks/framework.Ba_Ek9Jm.js";const l="/assets/img.TqtGDZeC.png",p="/assets/img_1.CGsnUwR5.png",h="/assets/img_2.BE-LoQMq.png",u=JSON.parse('{"title":"Pulumi 入门","description":"","frontmatter":{"title":"Pulumi 入门","date":"2022-04-26T00:00:00.000Z","tags":["IaC"],"category":["运维"]},"headers":[],"relativePath":"posts/2022/04/2022-04-26-pulumi.md","filePath":"posts/2022/04/2022-04-26-pulumi.md","lastUpdated":1718175555000}'),t={name:"posts/2022/04/2022-04-26-pulumi.md"},k=n(`<h2 id="安装-pulumi" tabindex="-1">安装 Pulumi <a class="header-anchor" href="#安装-pulumi" aria-label="Permalink to &quot;安装 Pulumi&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">brew</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> pulumi</span></span></code></pre></div><p>如果安装速度太慢，可使用脚本：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -fsSL</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://get.pulumi.com</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> sh</span></span></code></pre></div><p>或者下载安装包 <a href="https://get.pulumi.com/releases/sdk/pulumi-v3.32.1-darwin-x64.tar.gz" target="_blank" rel="noreferrer">Pulumi 3.32.1 for macOS</a> 手动安装。</p><p>安装成功后在输入命令测试下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> version</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">v3.32.1</span></span></code></pre></div><h2 id="选择-provider" tabindex="-1">选择 Provider <a class="header-anchor" href="#选择-provider" aria-label="Permalink to &quot;选择 Provider&quot;">​</a></h2><p>Pulumi 支持 AWS、Azure、Google Cloud、Kubernetes、Alibaba Cloud 等 Provider， 除 Kubernetes 之外的 Provider 均是在 Terraform 上的封装。</p><p>我们选择 Kubernetes 来作为本文测试的 Provider。</p><p>开始之前先安装好 kubectl 并链接到 Kubernetes，输入<code>kubectl cluster-info</code>测试。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cluster-info</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Kubernetes</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> control</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> plane</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> running</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://xxx:6443</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">metrics-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> running</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://xxx:6443/api/v1/namespaces/kube-system/services/heapster/proxy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">KubeDNS</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> running</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://xxx:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">To</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> further</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> debug</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> diagnose</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> cluster</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> problems,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> use</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;kubectl cluster-info dump&#39;.</span></span></code></pre></div><h2 id="创建项目" tabindex="-1">创建项目 <a class="header-anchor" href="#创建项目" aria-label="Permalink to &quot;创建项目&quot;">​</a></h2><p>Pulumi 支持 TypeScript、Python、Go、C#、Java等编程语言，我们选择比较简单的 TypeScript 来创建项目：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> quickstart</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> quickstart</span></span>
<span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubernetes-typescript</span></span></code></pre></div><p>第一次使用 <code>pulumi</code> 命令的时候，会提醒你登录 <code>Pulumi service</code>，此处我们直接敲<code>Enter</code>打开浏览器登录， 登录成功之后使用默认的选线创建项目。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubernetes-typescript</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Manage</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stacks</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> logging</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Run</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> login </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">--help</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> alternative login options.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Enter</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> access</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> token</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://app.pulumi.com/account/tokens</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    or</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> hit</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">ENTE</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">R</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> log</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> using</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> your</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> browser</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                   :</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">We</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;ve launched your web browser to complete the login process.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Waiting for login to complete...</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  Welcome to Pulumi!</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  Pulumi helps you create, deploy, and manage infrastructure on any cloud using</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  your favorite language. You can get started today with Pulumi at:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">      https://www.pulumi.com/docs/get-started/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  Tip of the day: Resources you create with Pulumi are given unique names (a randomly</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  generated suffix) by default. To learn more about auto-naming or customizing resource</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  names see https://www.pulumi.com/docs/intro/concepts/resources/#autonaming.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">This command will walk you through creating a new Pulumi project.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Enter a value or leave blank to accept the (default), and press &lt;ENTER&gt;.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Press ^C at any time to quit.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">project name: (quickstart)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">project description: (A minimal Kubernetes TypeScript Pulumi program)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Created project &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">quickstart</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Please enter your desired stack name.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">To create a stack in an organization, use the format &lt;org-name&gt;/&lt;stack-name&gt; (e.g. \`acmecorp/dev\`).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">stack name: (dev)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Created stack &#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">dev</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Installing dependencies...</span></span></code></pre></div><h2 id="文件目录简介" tabindex="-1">文件目录简介 <a class="header-anchor" href="#文件目录简介" aria-label="Permalink to &quot;文件目录简介&quot;">​</a></h2><p>生成的目录结构如下：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Pulumi.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> index.ts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> node_modules</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">├──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> package.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">└──</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> tsconfig.json</span></span></code></pre></div><ul><li><code>Pulumi.yaml</code> 定义项目</li><li><code>Pulumi.dev.yaml</code> 包含了刚刚初始化 stack 的配置值 <ul><li>如果没有配置，生成的项目可能没有这个文件</li></ul></li><li><code>index.ts</code> 定义 Pulumi 程序的 stack 资源</li></ul><p>查看 <code>index.ts</code>：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> k8s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@pulumi/kubernetes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> appLabels</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { app: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> deployment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> k8s.apps.v1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Deployment</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    spec: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        selector: { matchLabels: appLabels },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        replicas: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        template: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            metadata: { labels: appLabels },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            spec: { containers: [{ name: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, image: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> }] }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">});</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> deployment.metadata.name;</span></span></code></pre></div><h2 id="部署-stack" tabindex="-1">部署 Stack <a class="header-anchor" href="#部署-stack" aria-label="Permalink to &quot;部署 Stack&quot;">​</a></h2><p>执行命令：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>第一次执行安装插件会比较耗费时间</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">[resource plugin kubernetes-3.19.0] installing</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Downloading</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> plugin:</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 8.02</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> MiB</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 30.03</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> MiB</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [=====&gt;----------------]  26.70% 05m28s</span></span></code></pre></div></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Previewing</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (dev)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     Type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                              Name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            Plan</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   pulumi:pulumi:Stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">               quickstart-dev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  create</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   └─</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubernetes:apps/v1:Deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           create</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Resources:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    +</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> create</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Do</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> want</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> perform</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> update?</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  yes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  details</span></span></code></pre></div><p>选择<code>yes</code>，就会在 kubernetes 中创建资源。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Do</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> want</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> perform</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> update?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Updating</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (dev)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     Type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                              Name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            Status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   pulumi:pulumi:Stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">               quickstart-dev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  created</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   └─</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubernetes:apps/v1:Deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           created</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Outputs:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    name:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;nginx-dd1027fc&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Resources:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    +</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> created</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Duration:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 31s</span></span></code></pre></div><p>查看资源：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> kubectl get deployment</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">             READY</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   UP-TO-DATE</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   AVAILABLE</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">nginx-dd1027fc</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   1/1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">     1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">            1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           5m10s</span></span></code></pre></div><p>在 Pulumi Service 中查看：</p><p><img src="`+l+`" alt=""></p><h2 id="创建-service" tabindex="-1">创建 Service <a class="header-anchor" href="#创建-service" aria-label="Permalink to &quot;创建 Service&quot;">​</a></h2><p>下面创建一个 Service，并且根据环境变量来确定服务类型是 <code>ClusterIp</code> 还是 <code>LoadBalancer</code>。</p><p>设置变量：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> config</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> useLoadBalancer</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> false</span></span></code></pre></div><p>查看变量：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Pulumi.dev.yaml</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">config:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  quickstart:useLoadBalancer:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;false&quot;</span></span></code></pre></div><p>修改 <code>index.ts</code>：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> pulumi </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@pulumi/pulumi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> k8s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@pulumi/kubernetes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> pulumi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Config</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> useLoadBalancer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">requireBoolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;useLoadBalancer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> appName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> appLabels</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { app: appName };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> deployment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> k8s.apps.v1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Deployment</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(appName, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    spec: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        selector: { matchLabels: appLabels },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        replicas: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        template: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            metadata: { labels: appLabels },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            spec: { containers: [{ name: appName, image: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> }] }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// Allocate an IP to the Deployment.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> frontend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> k8s.core.v1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Service</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(appName, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    metadata: { labels: deployment.spec.template.metadata.labels },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    spec: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        type: useLoadBalancer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;LoadBalancer&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;ClusterIP&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        ports: [{ port: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, targetPort: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, protocol: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;TCP&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        selector: appLabels</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// When &quot;done&quot;, this will print the public IP.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> ip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> useLoadBalancer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    ?</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> frontend.status.loadBalancer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          (</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">lb</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> lb.ingress[</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">].ip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> lb.ingress[</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">].hostname</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    :</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> frontend.spec.clusterIP;</span></span></code></pre></div><p>重新部署</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Previewing</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (dev)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">View</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Live:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://app.pulumi.com/xxxx/quickstart/dev/previews/-89811d3d0ad3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     Type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                           Name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            Plan</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     pulumi:pulumi:Stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            quickstart-dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   └─</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubernetes:core/v1:Service</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           create</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Outputs:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;nginx-dd1027fc&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Resources:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    +</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> create</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> unchanged</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Do</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> want</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> perform</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> update?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Updating</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (dev)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">View</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Live:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> https://app.pulumi.com/xxxx/quickstart/dev/updates/2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     Type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                           Name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            Status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     pulumi:pulumi:Stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            quickstart-dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> +</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   └─</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubernetes:core/v1:Service</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           created</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Outputs:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  +</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  :</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;172.22.3.159&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> name:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;nginx-dd1027fc&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Resources:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    +</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> created</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    2</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> unchanged</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Duration:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 17s</span></span></code></pre></div><p>查看输出的变量：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> output</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">172.22.3.159</span></span></code></pre></div><p>查看服务：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">             TYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        CLUSTER-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     EXTERNAL-IP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   PORT</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">S</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)   </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">nginx-eeff4e2b</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   ClusterIP</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">   172.22.3.159</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">   &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">non</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">        80/TCP</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">    4m38s</span></span></code></pre></div><p>Pulumi Service 中查看： <img src="`+p+'" alt=""></p><p>由于没有创建外网 LoadBalancer，使用 port-forward 映射服务：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> service/nginx-eeff4e2b</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 8080:80</span></span></code></pre></div><p>访问服务</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">http://127.0.0.1:8080</span></span></code></pre></div><p><img src="'+h+`" alt=""></p><h2 id="返回-service-name" tabindex="-1">返回 Service Name <a class="header-anchor" href="#返回-service-name" aria-label="Permalink to &quot;返回 Service Name&quot;">​</a></h2><p>可以指定服务名称来创建服务：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> my_service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> kubernetes.core.v1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Service</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;my_service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    metadata: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        name: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;my-service&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    spec: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        selector: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            app: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;MyApp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        ports: [{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            protocol: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;TCP&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            port: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            targetPort: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">9376</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">});</span></span></code></pre></div><p>也可以把生成的 Service 返回，修改 <code>index.ts</code>：</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> pulumi </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@pulumi/pulumi&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> k8s </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;@pulumi/kubernetes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> pulumi.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Config</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> useLoadBalancer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> config.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">requireBoolean</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;useLoadBalancer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> appName</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> appLabels</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> { app: appName };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> deployment</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> k8s.apps.v1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Deployment</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(appName, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    spec: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        selector: { matchLabels: appLabels },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        replicas: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        template: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            metadata: { labels: appLabels },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            spec: { containers: [{ name: appName, image: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> }] }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// Allocate an IP to the Deployment.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> frontend</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> k8s.core.v1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">Service</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(appName, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    metadata: { labels: deployment.spec.template.metadata.labels },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    spec: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        type: useLoadBalancer </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;LoadBalancer&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> :</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;ClusterIP&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        ports: [{ port: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, targetPort: </span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, protocol: </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&quot;TCP&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        selector: appLabels</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// When &quot;done&quot;, this will print the public IP.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> ip</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> useLoadBalancer</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    ?</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> frontend.status.loadBalancer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">apply</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">          (</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">lb</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> lb.ingress[</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">].ip </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> lb.ingress[</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">].hostname</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">      )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    :</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> frontend.spec.clusterIP;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> service</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> frontend.metadata.name;</span></span></code></pre></div><p>部署 stack：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> up</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Previewing</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (dev)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     Type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                 Name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            Plan</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     pulumi:pulumi:Stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  quickstart-dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Outputs:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  +</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> service:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;nginx-eeff4e2b&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Resources:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> unchanged</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Do</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> want</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> perform</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> update?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Updating</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (dev)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     Type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                 Name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            Status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     pulumi:pulumi:Stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  quickstart-dev</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Outputs:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     :</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;172.22.3.159&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  +</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> service:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;nginx-eeff4e2b&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Resources:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> unchanged</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Duration:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 4s</span></span></code></pre></div><p>查看服务名称：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> output</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">nginx-eeff4e2b</span></span></code></pre></div><p>使用变量进行 port-forward：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> port-forward</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> service/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> output</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> service</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">8080:80</span></span></code></pre></div><h2 id="删除-stack" tabindex="-1">删除 Stack <a class="header-anchor" href="#删除-stack" aria-label="Permalink to &quot;删除 Stack&quot;">​</a></h2><p>执行 <code>pulumi destroy</code> 删除 Stack：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line highlighted"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">pulumi</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> destroy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Previewing</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> destroy</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (dev)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     Type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                              Name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            Plan</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   pulumi:pulumi:Stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">               quickstart-dev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  delete</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   ├─</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubernetes:core/v1:Service</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           delete</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   └─</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubernetes:apps/v1:Deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           delete</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Outputs:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     :</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;172.22.3.159&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> service:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;nginx-eeff4e2b&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Resources:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    -</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> delete</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Do</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> want</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> perform</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> destroy?</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Destroying</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (dev)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">     Type</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">                              Name</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">            Status</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   pulumi:pulumi:Stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">               quickstart-dev</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  deleted</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   ├─</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubernetes:core/v1:Service</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           deleted</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   └─</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kubernetes:apps/v1:Deployment</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">           deleted</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Outputs:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">     :</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;172.22.3.159&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> service:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;nginx-eeff4e2b&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Resources:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    -</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> deleted</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">Duration:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 6s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> resources</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> have</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> been</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> deleted,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> but</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> history</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> configuration</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> associated</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> with</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> are</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> still</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> maintained.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">If</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> you</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> want</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> remove</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> the</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> stack</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> completely,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;pulumi stack rm dev&#39;.</span></span></code></pre></div><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>通过自定义脚本和配置，我们可以灵活的进行基础资源编排；把把重要的信息定义为输出， 让我们能更好的与自动化集成。</p><hr><ul><li><a href="https://www.pulumi.com/registry/packages/kubernetes/api-docs/" target="_blank" rel="noreferrer">Pulumi Node.js API</a></li><li><a href="https://github.com/pulumi/pulumi-kubernetes" target="_blank" rel="noreferrer">Pulumi Kubernetes</a></li><li><a href="https://www.pulumi.com/" target="_blank" rel="noreferrer">Pulumi 官网</a></li></ul>`,72),e=[k];function F(d,r,g,y,c,D){return a(),i("div",null,e)}const C=s(t,[["render",F]]);export{u as __pageData,C as default};
