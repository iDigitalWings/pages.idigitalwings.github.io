import{_ as i,a,af as n,o as l}from"./chunks/framework.C87LdZyP.js";const r=JSON.parse('{"title":"Python 中的日志","description":"","frontmatter":{"title":"Python 中的日志","date":"2023-08-12T00:00:00.000Z","tags":["ai","llm"],"category":["python"]},"headers":[],"relativePath":"posts/2023/08/2023-08-12-logging-in-python.md","filePath":"posts/2023/08/2023-08-12-logging-in-python.md","lastUpdated":1718173059000}'),e={name:"posts/2023/08/2023-08-12-logging-in-python.md"};function t(p,s,h,k,d,g){return l(),a("div",null,s[0]||(s[0]=[n(`<p>日志记录是程序员工具箱中非常有用的工具。它可以帮助您更好地理解程序的流程，并发现您在开发时可能没有想到的场景。</p><h2 id="python-的日志模块" tabindex="-1">Python 的日志模块 <a class="header-anchor" href="#python-的日志模块" aria-label="Permalink to &quot;Python 的日志模块&quot;">​</a></h2><p>Python 中的日志模块是一个开箱即用且功能强大的模块。大多数第三方 Python 库都使用它来构建日志功能。</p><p>我们可以在 Python 程序中简单的导入日志模块：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> logging</span></span></code></pre></div><p>导入日志模块后，我们可以简单的使用 <code>logging</code> 来记录你想要查看的信息。 默认情况下，有5个标准级别来表示事件的严重程度，这五个级别按照<strong>严重性从低到高</strong>依次如下：</p><ul><li>DEBUG</li><li>INFO</li><li>WARNING</li><li>ERROR</li><li>CRITICAL</li></ul><p>日志模块提供了一个默认的 <code>logger</code>，无语配置即可使用。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">logging.debug(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;这是一个调试消息&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">logging.info(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;这是一个 info 消息&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">logging.warning(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;这是一个 warning 消息&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">logging.error(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;这是一个n error 消息&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">logging.critical(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;这是一个 critical 消息&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>输出如下：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">WARNING</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:root:这是一个 warning 消息</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">ERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:root:这是一个n error 消息</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">CRITICAL</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">:root:这是一个 critical 消息</span></span></code></pre></div><p>输出显示每条消息之前的<strong>严重性级别</strong>以及<strong>root</strong>，root 这是日志记录模块为其默认 logger 提供的名称。</p><p>我们看到：<code>debug()</code>和<code>info()</code>消息没有被记录。 这是因为，默认情况下，日志记录模块会记录严重级别为 WARNING 或更高级别的消息。</p><h2 id="基本配置" tabindex="-1">基本配置 <a class="header-anchor" href="#基本配置" aria-label="Permalink to &quot;基本配置&quot;">​</a></h2><p>我们可以使用 <code>basicConfig(**kwargs)</code> 方法，该方法有如下参数：</p><ul><li><code>level</code>：根记录器将设置为指定的严重性级别。</li><li><code>filename</code>：指定文件。</li><li><code>filemode</code>：如果filename给定，文件以此模式打开。默认为<code>a</code>，表示追加。</li><li><code>format</code>：这是日志消息的格式。</li></ul><h3 id="通过-level-指定日志级别" tabindex="-1">通过 level 指定日志级别 <a class="header-anchor" href="#通过-level-指定日志级别" aria-label="Permalink to &quot;通过 level 指定日志级别&quot;">​</a></h3><p>通过使用该level参数，可以设置要记录的日志消息的级别（通常使用 logging 的常量来指定）。</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">logging.basicConfig(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">level</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">logging.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">DEBUG</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">logging.debug(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;调试消息也会被输出&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">DEBUG:root:调试消息也会被输出</span></span></code></pre></div><p>现在，所有<code>DEBUG</code>级别或<code>DEBUG</code>级别以上的事件都将被记录。</p><h3 id="指定日志文件" tabindex="-1">指定日志文件 <a class="header-anchor" href="#指定日志文件" aria-label="Permalink to &quot;指定日志文件&quot;">​</a></h3><p>同样，对于记录到文件而不是控制台，可以使用 file 相关参数。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">logging.basicConfig(filename</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;app.log&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> filemode=&#39;w&#39;,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> format=&#39;%(name)s - %(levelname)s - %(message)s&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">logging.warning(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;输出到文件的日志&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>上面参数含义:</p><ul><li>filename：日志写入名为<code>app.log</code>的文件，而不是控制台</li><li>filemode：设置文件模式为<code>w</code>，表示每次<code>basicConfig()</code>调用时日志文件都以「写模式」打开，并且每次运行程序都会<strong>重写该文件</strong><ul><li>默认配置是<code>a</code>，表示 append。</li></ul></li></ul><p>打开 <code>app.log</code> 可以看到：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">root</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ERROR</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 输出到文件的日志</span></span></code></pre></div><div class="admonition note"><p class="admonition-title">basicConfig() 只能调用一次</p><p>第一次调用<code>basicConfig()</code>函数之后，后续调用会在 basicConfig() 在内部调用该函数</p></div><h3 id="使用-format-格式化输出" tabindex="-1">使用 format 格式化输出 <a class="header-anchor" href="#使用-format-格式化输出" aria-label="Permalink to &quot;使用 format 格式化输出&quot;">​</a></h3><p>使用<code>%(process)d</code>记录进程 ID：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">logging.basicConfig(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">%(process)d</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">%(levelname)s</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">%(message)s</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">logging.warning(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;这是一个 Warning 消息&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><p>输出可能是这样的：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">18973-WARNING-这是一个</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> Warning</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 消息</span></span></code></pre></div><p>使用 <code>%(asctime)s</code> 记录日期和时间信息：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">logging.basicConfig(</span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">format</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">%(asctime)s</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> - </span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">%(message)s</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">level</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">logging.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">INFO</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">logging.info(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;订单创建成功&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2023-12-01</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 20:22:05,388</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 订单创建成功</span></span></code></pre></div><p>修改时间格式：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">logging.basicConfig(format</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;%(asctime)s - %(message)s&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> datefmt=&#39;%d-%b-%y %H:%M:%S&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">logging.warning(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">&#39;订单创建成功&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">2-Dec-12</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 20:13:11</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 订单创建成功</span></span></code></pre></div><h3 id="使用变量" tabindex="-1">使用变量 <a class="header-anchor" href="#使用变量" aria-label="Permalink to &quot;使用变量&quot;">​</a></h3><p>我们还可以使用变量来快速格式化我们的消息：</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;羊顶天&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">logging.error(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#F47067;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 摔了一个跟头&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">, name)</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">ERROR:root:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 羊顶天</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> 摔了一个跟头</span></span></code></pre></div><p>上面示例中我们使用， <code>%s</code> 参数，</p>`,45)]))}const c=i(e,[["render",t]]);export{r as __pageData,c as default};
