import{_ as a,a as n,af as i,o as p}from"./chunks/framework.C87LdZyP.js";const o=JSON.parse('{"title":"Redis Sentinel","description":"","frontmatter":{"title":"Redis Sentinel","date":"2018-08-08T00:00:00.000Z","tags":["redis"],"category":["DevOps"]},"headers":[],"relativePath":"posts/2018/08/2018-08-08-redis-sentinel.md","filePath":"posts/2018/08/2018-08-08-redis-sentinel.md","lastUpdated":1718173059000}'),e={name:"posts/2018/08/2018-08-08-redis-sentinel.md"};function l(t,s,h,d,k,c){return p(),n("div",null,s[0]||(s[0]=[i('<h2 id="master" tabindex="-1">master <a class="header-anchor" href="#master" aria-label="Permalink to &quot;master&quot;">​</a></h2><p>注意这个bind，是redis服务绑定的地址，如果是<code>127.0.0.1</code>那么只有本机才可以连接该redis。</p><p><code>redis.conf</code></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">bind</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6000</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> .</span></span></code></pre></div><p><code>sentinel.conf</code></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Host and port we will listen for requests on</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">bind</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6100</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># &quot;redis-cluster&quot; is the name of our cluster</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># each sentinel process is paired with a redis-server process</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> monitor</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis-cluster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6380</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> down-after-milliseconds</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis-cluster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5000</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> parallel-syncs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis-cluster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> failover-timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis-cluster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10000</span></span></code></pre></div><h2 id="slave" tabindex="-1">slave <a class="header-anchor" href="#slave" aria-label="Permalink to &quot;slave&quot;">​</a></h2><p><code>redis.conf</code></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">bind</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6001</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> .</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">slaveof</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6000</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 这里是master redis的地址</span></span></code></pre></div><p><code>sentinel.conf</code></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Host and port we will listen for requests on</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">bind</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6101</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># &quot;redis-cluster&quot; is the name of our cluster</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># each sentinel process is paired with a redis-server process</span></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> monitor</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis-cluster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6380</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 2</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 这里是 master redis的地址</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> down-after-milliseconds</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis-cluster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 5000</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> parallel-syncs</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis-cluster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> failover-timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis-cluster</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 10000</span></span></code></pre></div><p>第二个slave配置同上，自己的地址和端口不同而已。</p><h2 id="启动" tabindex="-1">启动 <a class="header-anchor" href="#启动" aria-label="Permalink to &quot;启动&quot;">​</a></h2><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">src/redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> redis.conf</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">src/redis-sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> sentinel.conf</span></span></code></pre></div><p>Master Redis 的日志，可以看到，在salve的redis启动后，控制台有加入集群的输出：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>19042:M 08 Aug 17:04:46.979 * Increased maximum number of open files to 10032 (it was originally set to 4864).</span></span>\n<span class="line"><span>                _._</span></span>\n<span class="line"><span>           _.-``__ &#39;&#39;-._</span></span>\n<span class="line"><span>      _.-``    `.  `_.  &#39;&#39;-._           Redis 3.2.12 (00000000/0) 64 bit</span></span>\n<span class="line"><span>  .-`` .-```.  ```\\/    _.,_ &#39;&#39;-._</span></span>\n<span class="line"><span> (    &#39;      ,       .-`  | `,    )     Running in standalone mode</span></span>\n<span class="line"><span> |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 6000</span></span>\n<span class="line"><span> |    `-._   `._    /     _.-&#39;    |     PID: 19042</span></span>\n<span class="line"><span>  `-._    `-._  `-./  _.-&#39;    _.-&#39;</span></span>\n<span class="line"><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|</span></span>\n<span class="line"><span> |    `-._`-._        _.-&#39;_.-&#39;    |           http://redis.io</span></span>\n<span class="line"><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;</span></span>\n<span class="line"><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|</span></span>\n<span class="line"><span> |    `-._`-._        _.-&#39;_.-&#39;    |</span></span>\n<span class="line"><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;</span></span>\n<span class="line"><span>      `-._    `-.__.-&#39;    _.-&#39;</span></span>\n<span class="line"><span>          `-._        _.-&#39;</span></span>\n<span class="line"><span>              `-.__.-&#39;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>19042:M 08 Aug 17:04:46.981 # Server started, Redis version 3.2.12</span></span>\n<span class="line"><span>19042:M 08 Aug 17:04:46.981 * The server is now ready to accept connections on port 6000</span></span>\n<span class="line"><span>19042:M 08 Aug 17:04:57.893 * Slave 127.0.0.1:6001 asks for synchronization</span></span>\n<span class="line"><span>19042:M 08 Aug 17:04:57.893 * Full resync requested by slave 127.0.0.1:6001</span></span>\n<span class="line"><span>19042:M 08 Aug 17:04:57.893 * Starting BGSAVE for SYNC with target: disk</span></span>\n<span class="line"><span>19042:M 08 Aug 17:04:57.893 * Background saving started by pid 19045</span></span>\n<span class="line"><span>19045:C 08 Aug 17:04:57.894 * DB saved on disk</span></span>\n<span class="line"><span>19042:M 08 Aug 17:04:57.968 * Background saving terminated with success</span></span>\n<span class="line"><span>19042:M 08 Aug 17:04:57.968 * Synchronization with slave 127.0.0.1:6001 succeeded</span></span>\n<span class="line"><span>19042:M 08 Aug 17:05:40.730 * Slave 127.0.0.1:6002 asks for synchronization</span></span>\n<span class="line"><span>19042:M 08 Aug 17:05:40.730 * Full resync requested by slave 127.0.0.1:6002</span></span>\n<span class="line"><span>19042:M 08 Aug 17:05:40.730 * Starting BGSAVE for SYNC with target: disk</span></span>\n<span class="line"><span>19042:M 08 Aug 17:05:40.731 * Background saving started by pid 19054</span></span>\n<span class="line"><span>19054:C 08 Aug 17:05:40.732 * DB saved on disk</span></span>\n<span class="line"><span>19042:M 08 Aug 17:05:40.817 * Background saving terminated with success</span></span>\n<span class="line"><span>19042:M 08 Aug 17:05:40.817 * Synchronization with slave 127.0.0.1:6002 succeeded</span></span></code></pre></div><p>查看集群信息：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 6000</span></span>\n<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> info</span></span></code></pre></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Replication</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">role:master</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">connected_slaves:2</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">slave0:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=127.0.0.1,port=6001,state=online,offset=15338,lag=0</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">slave1:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">=127.0.0.1,port=6002,state=online,offset=15338,lag=1</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">master_repl_offset:15470</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_active:1</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_size:1048576</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_first_byte_offset:2</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">repl_backlog_histlen:15469</span></span></code></pre></div><p><code>Master Sentinel</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>19061:X 08 Aug 17:06:19.355 * Increased maximum number of open files to 10032 (it was originally set to 4864).</span></span>\n<span class="line"><span>                _._</span></span>\n<span class="line"><span>           _.-``__ &#39;&#39;-._</span></span>\n<span class="line"><span>      _.-``    `.  `_.  &#39;&#39;-._           Redis 3.2.12 (00000000/0) 64 bit</span></span>\n<span class="line"><span>  .-`` .-```.  ```\\/    _.,_ &#39;&#39;-._</span></span>\n<span class="line"><span> (    &#39;      ,       .-`  | `,    )     Running in sentinel mode</span></span>\n<span class="line"><span> |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 6100</span></span>\n<span class="line"><span> |    `-._   `._    /     _.-&#39;    |     PID: 19061</span></span>\n<span class="line"><span>  `-._    `-._  `-./  _.-&#39;    _.-&#39;</span></span>\n<span class="line"><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|</span></span>\n<span class="line"><span> |    `-._`-._        _.-&#39;_.-&#39;    |           http://redis.io</span></span>\n<span class="line"><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;</span></span>\n<span class="line"><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|</span></span>\n<span class="line"><span> |    `-._`-._        _.-&#39;_.-&#39;    |</span></span>\n<span class="line"><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;</span></span>\n<span class="line"><span>      `-._    `-.__.-&#39;    _.-&#39;</span></span>\n<span class="line"><span>          `-._        _.-&#39;</span></span>\n<span class="line"><span>              `-.__.-&#39;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>19061:X 08 Aug 17:06:19.359 # Sentinel ID is df930b6e6dc5fc83ee769897a4a5f5e9b2b67ab3</span></span>\n<span class="line"><span>19061:X 08 Aug 17:06:19.359 # +monitor master mymaster 127.0.0.1 6380 quorum 2</span></span>\n<span class="line"><span>19061:X 08 Aug 17:06:24.425 # +sdown master mymaster 127.0.0.1 6380</span></span></code></pre></div><p><code>Slave Sentinel</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span>19062:X 08 Aug 17:06:21.152 * Increased maximum number of open files to 10032 (it was originally set to 4864).</span></span>\n<span class="line"><span>                _._</span></span>\n<span class="line"><span>           _.-``__ &#39;&#39;-._</span></span>\n<span class="line"><span>      _.-``    `.  `_.  &#39;&#39;-._           Redis 3.2.12 (00000000/0) 64 bit</span></span>\n<span class="line"><span>  .-`` .-```.  ```\\/    _.,_ &#39;&#39;-._</span></span>\n<span class="line"><span> (    &#39;      ,       .-`  | `,    )     Running in sentinel mode</span></span>\n<span class="line"><span> |`-._`-...-` __...-.``-._|&#39;` _.-&#39;|     Port: 6101</span></span>\n<span class="line"><span> |    `-._   `._    /     _.-&#39;    |     PID: 19062</span></span>\n<span class="line"><span>  `-._    `-._  `-./  _.-&#39;    _.-&#39;</span></span>\n<span class="line"><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|</span></span>\n<span class="line"><span> |    `-._`-._        _.-&#39;_.-&#39;    |           http://redis.io</span></span>\n<span class="line"><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;</span></span>\n<span class="line"><span> |`-._`-._    `-.__.-&#39;    _.-&#39;_.-&#39;|</span></span>\n<span class="line"><span> |    `-._`-._        _.-&#39;_.-&#39;    |</span></span>\n<span class="line"><span>  `-._    `-._`-.__.-&#39;_.-&#39;    _.-&#39;</span></span>\n<span class="line"><span>      `-._    `-.__.-&#39;    _.-&#39;</span></span>\n<span class="line"><span>          `-._        _.-&#39;</span></span>\n<span class="line"><span>              `-.__.-&#39;</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>19062:X 08 Aug 17:06:21.156 # Sentinel ID is 74dbb7f17f37830cb61813574809836307fe66c9</span></span>\n<span class="line"><span>19062:X 08 Aug 17:06:21.156 # +monitor master mymaster 127.0.0.1 6000 quorum 2</span></span>\n<span class="line"><span>19062:X 08 Aug 17:06:21.157 * +slave slave 127.0.0.1:6001 127.0.0.1 6001 @ mymaster 127.0.0.1 6000</span></span>\n<span class="line"><span>19062:X 08 Aug 17:06:21.157 * +slave slave 127.0.0.1:6002 127.0.0.1 6002 @ mymaster 127.0.0.1 6000</span></span>\n<span class="line"><span>19062:X 08 Aug 17:06:25.105 * +sentinel sentinel 243f24d56b3e896480447c996f974fb7d140b72b 127.0.0.1 6102 @ mymaster 127.0.0.1 6000</span></span></code></pre></div>',23)]))}const _=a(e,[["render",l]]);export{o as __pageData,_ as default};
