import{_ as i,a,af as n,o as l}from"./chunks/framework.C87LdZyP.js";const A=JSON.parse('{"title":"View log runtime using redis","description":"","frontmatter":{"title":"View log runtime using redis","date":"2017-07-17T00:00:00.000Z","tags":["redis","logback","java"]},"headers":[],"relativePath":"posts/2017/07/2017-07-17-toggle-redis-logback.md","filePath":"posts/2017/07/2017-07-17-toggle-redis-logback.md","lastUpdated":1718193786000}'),p={name:"posts/2017/07/2017-07-17-toggle-redis-logback.md"};function t(e,s,k,h,r,d){return l(),a("div",null,s[0]||(s[0]=[n(`<p>一个在线查看日志的需求,要可以运行时查看(点击查看开始看,点击停止就不看了).</p><p>有一些方案:</p><ul><li>JMX</li><li>读取日志File</li><li>自定义Appender</li></ul><p>我觉得应该还会更可行的方法,但是基于简单可维护,我这里自定义一个<code> Appender</code>, 根据系统参数记录日志到<code>Redis</code>,后台读取Redis把日志返回.</p><p>基于<code>logback-redis-appender</code>定制<code>RedisAppender</code>类:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">protected</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> append</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(ILoggingEvent event) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">RedisLogConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    Jedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> client</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> pool.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">getResource</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">    try</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        String</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> json</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> layout </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> ?</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> jsonlayout.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">doLayout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(event) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> layout.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">doLayout</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(event)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        client.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">rpush</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(key, json)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (Exception </span><span style="--shiki-light:#E36209;--shiki-dark:#F69D50;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        e.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        pool.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">returnBrokenResource</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(client)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> (client </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">            pool.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">returnResource</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(client)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><hr><p>Links:</p><ul><li><a href="https://github.com/kmtong/logback-redis-appender" target="_blank" rel="noreferrer">logback-redis-appender</a></li></ul><hr><div style="text-align:center;color:#00000099;font-size:14px;">END</div>`,11)]))}const o=i(p,[["render",t]]);export{A as __pageData,o as default};
