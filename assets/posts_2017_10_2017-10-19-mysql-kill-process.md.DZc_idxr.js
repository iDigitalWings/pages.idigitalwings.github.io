import{_ as i,a,af as h,o as k}from"./chunks/framework.C87LdZyP.js";const g=JSON.parse('{"title":"Mysql batch kill connections","description":"","frontmatter":{"title":"Mysql batch kill connections","date":"2017-10-19T00:00:00.000Z","tags":["mysql"]},"headers":[],"relativePath":"posts/2017/10/2017-10-19-mysql-kill-process.md","filePath":"posts/2017/10/2017-10-19-mysql-kill-process.md","lastUpdated":1718193786000}'),t={name:"posts/2017/10/2017-10-19-mysql-kill-process.md"};function l(n,s,p,e,d,F){return k(),a("div",null,s[0]||(s[0]=[h(`<div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> concat</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;KILL &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,id,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">processlist</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;root&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> db</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;itms&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">select</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> concat</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;KILL &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">,id,</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">from</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">processlist</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;root&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> into</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> outfile </span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;/tmp/a.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">source </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">tmp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">txt</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">;</span></span></code></pre></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mysqladmin</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -uroot</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> processlist</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">awk</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;|&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;{print $2}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">xargs</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mysqladmin</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -uroot</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kill</span></span></code></pre></div><p>杀掉指定用户运行的连接，这里为Mike</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mysqladmin</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -uroot</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> processlist</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">awk</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;|&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;{if($3 == &quot;Mike&quot;)print $2}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">xargs</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> mysqladmin</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -uroot</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kill</span></span></code></pre></div><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#杀掉锁定的MySQL连接</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">in</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mysqladmin</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> processlist</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> locked</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">awk</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;{print $1}&#39;\`</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">do</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">   mysqladmin</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> kill</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> \${id}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">done</span></span></code></pre></div><p>通过Maatkit工具集中提供的mk-kill命令进行</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#杀掉超过60秒的sql</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mk-kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -busy-time</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 60</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -kill</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#如果你想先不杀，先看看有哪些sql运行超过60秒</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mk-kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -busy-time</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 60</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -print</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">#如果你想杀掉，同时输出杀掉了哪些进程</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">mk-kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -busy-time</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> 60</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -print</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> –kill</span></span></code></pre></div><hr><div style="text-align:center;color:#00000099;font-size:14px;">END</div>`,9)]))}const y=i(t,[["render",l]]);export{g as __pageData,y as default};
