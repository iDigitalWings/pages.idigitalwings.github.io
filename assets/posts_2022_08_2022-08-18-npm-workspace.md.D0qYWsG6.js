import{_ as i,a,af as n,o as p}from"./chunks/framework.C87LdZyP.js";const c=JSON.parse('{"title":"NPM Workspaces","description":"","frontmatter":{"title":"NPM Workspaces","date":"2022-08-18T00:00:00.000Z","tags":["npm"],"category":["其它"]},"headers":[],"relativePath":"posts/2022/08/2022-08-18-npm-workspace.md","filePath":"posts/2022/08/2022-08-18-npm-workspace.md","lastUpdated":1718173059000}'),l={name:"posts/2022/08/2022-08-18-npm-workspace.md"};function h(t,s,e,k,d,F){return p(),a("div",null,s[0]||(s[0]=[n(`<p>NPM 7.x 支持了 Workspace 功能。</p><p>在 <code>package.json</code> 中通过 <code>workspaces</code> 定义。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;name&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;my-workspaces-powered-project&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;workspaces&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;packages/a&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>也可以使用通配符<code>&quot;workspaces&quot;: [&quot;./packages/*&quot;]</code>：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;name&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &quot;my-workspaces-powered-project&quot;,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">  &quot;workspaces&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">    &quot;packages/*&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">}</span></span></code></pre></div><p>目录如下，<code>a</code> 目录也包含 <code>package.json</code> 定义：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">+--</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> package.json</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">   +--</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">   |</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> package.json</span></span></code></pre></div><p>执行 <code>npm install</code> ，<code>packages/a</code> 会链接到 <code>node_modules</code> 目录：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">+--</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> node_modules</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">  \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a -</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ../packages/a</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">+--</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> package-lock.json</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">+--</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> package.json</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">\`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">   +--</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">   |</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">   \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">--</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> package.json</span></span></code></pre></div><p>可以通过 <code>npm init</code> 命令初始化 workspace：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> init</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> ./packages/a</span></span></code></pre></div><p>为 <code>a</code> 添加依赖：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lodash</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -w</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lodash</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --workspace</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> lodash</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --workspace</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> a</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --save-dev</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># Install \`eslint\` in all packages</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> eslint</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --workspaces</span></span></code></pre></div><p>可以直接使用 workspace：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// ./packages/a/index.js</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">module</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">exports</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> &#39;a&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// ./lib/index.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> moduleA</span><span style="--shiki-light:#D73A49;--shiki-dark:#F47067;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;"> require</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;">&#39;a&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#DCBDFB;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;">(moduleA) </span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;">// -&gt; a</span></span></code></pre></div><p>执行命令：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark-dimmed vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --workspace=a</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 等同于</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> packages/a</span><span style="--shiki-light:#24292E;--shiki-dark:#ADBAC7;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"># 指定多个空间</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --workspace=a</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --workspace=b</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> --workspaces</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 按照 package.json 中定义的顺序执行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#F69D50;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#96D0FF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#6CB6FF;"> -ws</span><span style="--shiki-light:#6A737D;--shiki-dark:#768390;"> # 按照 package.json 中定义的顺序执行</span></span></code></pre></div><hr><ul><li><a href="https://docs.npmjs.com/cli/v8/using-npm/workspaces" target="_blank" rel="noreferrer">NPM workspaces</a></li><li><a href="https://ruanmartinelli.com/posts/npm-7-workspaces-1" target="_blank" rel="noreferrer">Getting Started with npm Workspaces</a></li></ul>`,19)]))}const g=i(l,[["render",h]]);export{c as __pageData,g as default};
